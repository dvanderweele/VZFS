(()=>{var Hr=Object.defineProperty;var Ye=(e,t)=>{for(var r in t)Hr(e,r,{get:t[r],enumerable:!0})};function V(e,t){if(!/^[a-zA-Z0-9_/.-]*$/.test(e))throw"Invalid character(s) in path.";if(e==="/..")throw"Invalid path";if(e==="/."&&(e="/"),/\/\.\.$/.test(e)&&(e=`${e}/`),console.log(e),e=e.split("/").reduce((r,n,i,o)=>(r.push(n),r),[]).filter((r,n,i)=>!(n>0&&n<i.length-1&&r==="")),e.length===1)return`/${e.reduce((r,n)=>n==="."?r:n===".."?r.slice(0,-1):[...r,n],[]).join("/")}`;if(e[0]===""){let r=`${e.reduce((n,i)=>i==="."?n:i===".."?n.slice(0,-1):[...n,i],[]).join("/")}`;if(r==="")throw"Invalid path";return r}else{let n=`${[...t,...e].reduce((i,o)=>o==="."?i:o===".."?i.slice(0,-1):[...i,o],[]).join("/")}`;if(n==="")throw"Invalid path";return n}}function G(e){return e.split("/").reduce((t,r)=>(t.push(r),t),[]).filter((t,r,n)=>!(r>0&&r<n.length-1&&t===""))}var Zr=["/home/user/file.js","/absolute/path/to/file.js","relative/path/to/file.js","../relative/path/to/file.js","./relative/path/to/file.js","/root/directory/../file.js","file.js","../../../file.js","/home/user/../file.js","../file.js","./file.js","/root/directory/./file.js","","/","../","./",".../","/..","/.","/../","../../../","/../../..","../../../..","/../../../../",".","..","//","////",".//file.js","..//file.js","directory/","directory/..","../directory/","./directory/"];function tn(){let e=["","abc","123"];Zr.forEach(t=>{try{console.log(`original: ${t}`),console.log(`normalized: ${V(t,e)}`),console.log(`pieces: ${JSON.stringify(G(V(t,e)))}`),console.log(`renormalized: ${V(G(V(t,e)).join("/"),e)}`),console.log("--------")}catch(r){console.log(r)}})}var We=tn;var $t={};Ye($t,{actionTypes:()=>Ae,after:()=>Ie,assign:()=>mr,cancel:()=>$e,choose:()=>Sr,done:()=>kt,doneInvoke:()=>pt,error:()=>yt,escalate:()=>un,forwardTo:()=>wr,getActionFunction:()=>Qt,initEvent:()=>it,isActionObject:()=>cn,log:()=>pr,pure:()=>gr,raise:()=>Zt,resolveActions:()=>xt,resolveLog:()=>yr,resolveRaise:()=>fr,resolveSend:()=>dr,resolveStop:()=>vr,respond:()=>an,send:()=>ht,sendParent:()=>te,sendTo:()=>ke,sendUpdate:()=>hr,start:()=>Ce,stop:()=>me,toActionObject:()=>Tt,toActionObjects:()=>rt,toActivityDefinition:()=>Ht});var h=function(){return h=Object.assign||function(t){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},h.apply(this,arguments)};function Ft(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function T(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function F(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=n.next()).done;)o.push(i.value)}catch(c){a={error:c}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return o}function N(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))}var D;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(D||(D={}));var et;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(et||(et={}));var Ae={};Ye(Ae,{after:()=>en,assign:()=>Ut,cancel:()=>Bt,choose:()=>Pe,doneState:()=>rn,error:()=>Kt,errorExecution:()=>nn,errorPlatform:()=>ce,init:()=>Fe,invoke:()=>At,log:()=>Ot,nullEvent:()=>Ee,pure:()=>Oe,raise:()=>ut,send:()=>dt,start:()=>Pt,stop:()=>gt,update:()=>wt});var Pt=D.Start,gt=D.Stop,ut=D.Raise,dt=D.Send,Bt=D.Cancel,Ee=D.NullEvent,Ut=D.Assign,en=D.After,rn=D.DoneState,Ot=D.Log,Fe=D.Init,At=D.Invoke,nn=D.ErrorExecution,ce=D.ErrorPlatform,Kt=D.ErrorCustom,wt=D.Update,Pe=D.Choose,Oe=D.Pure;var ue=".",De={},le="xstate.guard",Qe="";var R=!0;var fe;function Gt(e,t,r){r===void 0&&(r=ue);var n=Dt(e,r),i=Dt(t,r);return P(i)?P(n)?i===n:!1:P(n)?n in i:Object.keys(n).every(function(o){return o in i?Gt(n[o],i[o]):!1})}function de(e){try{return P(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function he(e,t){try{return lt(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function on(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function Dt(e,t){if(on(e))return e.value;if(lt(e))return Vt(e);if(typeof e!="string")return e;var r=he(e,t);return Vt(r)}function Vt(e){if(e.length===1)return e[0];for(var t={},r=t,n=0;n<e.length-1;n++)n===e.length-2?r[e[n]]=e[n+1]:(r[e[n]]={},r=r[e[n]]);return t}function _t(e,t){for(var r={},n=Object.keys(e),i=0;i<n.length;i++){var o=n[i];r[o]=t(e[o],o,e,i)}return r}function _e(e,t,r){var n,i,o={};try{for(var a=T(Object.keys(e)),c=a.next();!c.done;c=a.next()){var s=c.value,u=e[s];r(u)&&(o[s]=t(u,s,e))}}catch(l){n={error:l}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}var He=function(e){return function(t){var r,n,i=t;try{for(var o=T(e),a=o.next();!a.done;a=o.next()){var c=a.value;i=i[c]}}catch(s){r={error:s}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}};function Ze(e,t){return function(r){var n,i,o=r;try{for(var a=T(e),c=a.next();!c.done;c=a.next()){var s=c.value;o=o[t][s]}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}}function Xt(e){if(!e)return[[]];if(P(e))return[[e]];var t=j(Object.keys(e).map(function(r){var n=e[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:Xt(e[r]).map(function(i){return[r].concat(i)})}));return t}function j(e){var t;return(t=[]).concat.apply(t,N([],F(e),!1))}function tr(e){return lt(e)?e:[e]}function Y(e){return e===void 0?[]:tr(e)}function St(e,t,r){var n,i;if(O(e))return e(t,r.data);var o={};try{for(var a=T(Object.keys(e)),c=a.next();!c.done;c=a.next()){var s=c.value,u=e[s];O(u)?o[s]=u(t,r.data):o[s]=u}}catch(l){n={error:l}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}function er(e){return/^(done|error)\./.test(e)}function Ne(e){return!!(e instanceof Promise||e!==null&&(O(e)||typeof e=="object")&&O(e.then))}function rr(e){return e!==null&&typeof e=="object"&&"transition"in e&&typeof e.transition=="function"}function nr(e,t){var r,n,i=F([[],[]],2),o=i[0],a=i[1];try{for(var c=T(e),s=c.next();!s.done;s=c.next()){var u=s.value;t(u)?o.push(u):a.push(u)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return[o,a]}function ir(e,t){return _t(e.states,function(r,n){if(r){var i=(P(t)?void 0:t[n])||(r?r.current:void 0);if(i)return{current:i,states:ir(r,i)}}})}function or(e,t){return{current:t,states:ir(e,t)}}function Re(e,t,r,n){R||M(!!e,"Attempting to update undefined context");var i=e&&r.reduce(function(o,a){var c,s,u=a.assignment,l={state:n,action:a,_event:t},d={};if(O(u))d=u(o,t.data,l);else try{for(var f=T(Object.keys(u)),p=f.next();!p.done;p=f.next()){var v=p.value,m=u[v];d[v]=O(m)?m(o,t.data,l):m}}catch(b){c={error:b}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(c)throw c.error}}return Object.assign({},o,d)},e);return i}var M=function(){};R||(M=function(e,t){var r=e instanceof Error?e:void 0;if(!(!r&&e)&&console!==void 0){var n=["Warning: ".concat(t)];r&&n.push(r),console.warn.apply(console,n)}});function lt(e){return Array.isArray(e)}function O(e){return typeof e=="function"}function P(e){return typeof e=="string"}function pe(e,t){if(e)return P(e)?{type:le,name:e,predicate:t?t[e]:void 0}:O(e)?{type:le,name:e.name,predicate:e}:e}function ar(e){try{return"subscribe"in e&&O(e.subscribe)}catch{return!1}}var nt=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Ln=(fe={},fe[nt]=function(){return this},fe[Symbol.observable]=function(){return this},fe);function W(e){return!!e&&"__xstatenode"in e}function sr(e){return!!e&&typeof e.send=="function"}var cr=function(){var e=0;return function(){return e++,e.toString(16)}}();function Nt(e,t){return P(e)||typeof e=="number"?h({type:e},t):e}function z(e,t){if(!P(e)&&"$$type"in e&&e.$$type==="scxml")return e;var r=Nt(e);return h({name:r.type,data:r,$$type:"scxml",type:"external"},t)}function bt(e,t){var r=tr(t).map(function(n){return typeof n>"u"||typeof n=="string"||W(n)?{target:n,event:e}:h(h({},n),{event:e})});return r}function ur(e){if(!(e===void 0||e===Qe))return Y(e)}function lr(e,t,r){if(!R){var n=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";if(e===t)console.error("Missing onError handler for invocation '".concat(r,"', error was '").concat(e,"'.").concat(n));else{var i=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(r,"'. ")+"Original error: '".concat(e,"'. ").concat(n," Current error is '").concat(t,"'.").concat(i))}}}function ye(e,t,r,n,i){var o=e.options.guards,a={state:i,cond:t,_event:n};if(t.type===le)return(o?.[t.name]||t.predicate)(r,n.data,a);var c=o?.[t.type];if(!c)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return c(r,n.data,a)}function ve(e){return typeof e=="string"?{type:e}:e}function Rt(e,t,r){var n=function(){},i=typeof e=="object",o=i?e:null;return{next:((i?e.next:e)||n).bind(o),error:((i?e.error:t)||n).bind(o),complete:((i?e.complete:r)||n).bind(o)}}function Yt(e,t){return"".concat(e,":invocation[").concat(t,"]")}function Wt(e){return(e.type===ut||e.type===dt&&e.to===et.Internal)&&typeof e.delay!="number"}var it=z({type:Fe});function Qt(e,t){return t&&t[e]||void 0}function Tt(e,t){var r;if(P(e)||typeof e=="number"){var n=Qt(e,t);O(n)?r={type:e,exec:n}:n?r=n:r={type:e,exec:void 0}}else if(O(e))r={type:e.name||e.toString(),exec:e};else{var n=Qt(e.type,t);if(O(n))r=h(h({},e),{exec:n});else if(n){var i=n.type||e.type;r=h(h(h({},n),e),{type:i})}else r=e}return r}var rt=function(e,t){if(!e)return[];var r=lt(e)?e:[e];return r.map(function(n){return Tt(n,t)})};function Ht(e){var t=Tt(e);return h(h({id:P(e)?e:t.id},t),{type:t.type})}function Zt(e,t){return{type:ut,event:typeof e=="function"?e:Nt(e),delay:t?t.delay:void 0,id:t?.id}}function fr(e,t,r,n){var i={_event:r},o=z(O(e.event)?e.event(t,r.data,i):e.event),a;if(P(e.delay)){var c=n&&n[e.delay];a=O(c)?c(t,r.data,i):c}else a=O(e.delay)?e.delay(t,r.data,i):e.delay;return h(h({},e),{type:ut,_event:o,delay:a})}function ht(e,t){return{to:t?t.to:void 0,type:dt,event:O(e)?e:Nt(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:O(e)?e.name:de(e)}}function dr(e,t,r,n){var i={_event:r},o=z(O(e.event)?e.event(t,r.data,i):e.event),a;if(P(e.delay)){var c=n&&n[e.delay];a=O(c)?c(t,r.data,i):c}else a=O(e.delay)?e.delay(t,r.data,i):e.delay;var s=O(e.to)?e.to(t,r.data,i):e.to;return h(h({},e),{to:s,_event:o,event:o.data,delay:a})}function te(e,t){return ht(e,h(h({},t),{to:et.Parent}))}function ke(e,t,r){return ht(t,h(h({},r),{to:e}))}function hr(){return te(wt)}function an(e,t){return ht(e,h(h({},t),{to:function(r,n,i){var o=i._event;return o.origin}}))}var sn=function(e,t){return{context:e,event:t}};function pr(e,t){return e===void 0&&(e=sn),{type:Ot,label:t,expr:e}}var yr=function(e,t,r){return h(h({},e),{value:P(e.expr)?e.expr:e.expr(t,r.data,{_event:r})})},$e=function(e){return{type:Bt,sendId:e}};function Ce(e){var t=Ht(e);return{type:D.Start,activity:t,exec:void 0}}function me(e){var t=O(e)?e:Ht(e);return{type:D.Stop,activity:t,exec:void 0}}function vr(e,t,r){var n=O(e.activity)?e.activity(t,r.data):e.activity,i=typeof n=="string"?{id:n}:n,o={type:D.Stop,activity:i};return o}var mr=function(e){return{type:Ut,assignment:e}};function cn(e){return typeof e=="object"&&"type"in e}function Ie(e,t){var r=t?"#".concat(t):"";return"".concat(D.After,"(").concat(e,")").concat(r)}function kt(e,t){var r="".concat(D.DoneState,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function pt(e,t){var r="".concat(D.DoneInvoke,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function yt(e,t){var r="".concat(D.ErrorPlatform,".").concat(e),n={type:r,data:t};return n.toString=function(){return r},n}function gr(e){return{type:D.Pure,get:e}}function wr(e,t){if(!R&&(!e||typeof e=="function")){var r=e;e=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=typeof r=="function"?r.apply(void 0,N([],F(n),!1)):r;if(!o)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return o}}return ht(function(n,i){return i},h(h({},t),{to:e}))}function un(e,t){return te(function(r,n,i){return{type:Kt,data:O(e)?e(r,n,i):e}},h(h({},t),{to:et.Parent}))}function Sr(e){return{type:D.Choose,conds:e}}var ln=function(e){var t,r,n=[];try{for(var i=T(e),o=i.next();!o.done;o=i.next())for(var a=o.value,c=0;c<a.actions.length;){if(a.actions[c].type===Ut){n.push(a.actions[c]),a.actions.splice(c,1);continue}c++}}catch(s){t={error:s}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n};function xt(e,t,r,n,i,o,a){a===void 0&&(a=!1);var c=a?[]:ln(i),s=c.length?Re(r,n,c,t):r,u=a?[r]:void 0,l=[];function d(v,m){var b;switch(m.type){case ut:{var w=fr(m,s,n,e.options.delays);return o&&typeof w.delay=="number"&&o(w,s,n),w}case dt:var g=dr(m,s,n,e.options.delays);if(!R){var S=m.delay;M(!P(S)||typeof g.delay=="number","No delay reference for delay expression '".concat(S,"' was found on machine '").concat(e.id,"'"))}return o&&g.to!==et.Internal&&(v==="entry"?l.push(g):o(g,s,n)),g;case Ot:{var x=yr(m,s,n);return o?.(x,s,n),x}case Pe:{var L=m,C=(b=L.conds.find(function(mt){var ft=pe(mt.cond,e.options.guards);return!ft||ye(e,ft,s,n,o?void 0:t)}))===null||b===void 0?void 0:b.actions;if(!C)return[];var _=F(xt(e,t,s,n,[{type:v,actions:rt(Y(C),e.options.actions)}],o,a),2),I=_[0],A=_[1];return s=A,u?.push(s),I}case Oe:{var C=m.get(s,n.data);if(!C)return[];var q=F(xt(e,t,s,n,[{type:v,actions:rt(Y(C),e.options.actions)}],o,a),2),E=q[0],J=q[1];return s=J,u?.push(s),E}case gt:{var x=vr(m,s,n);return o?.(x,r,n),x}case Ut:{s=Re(s,n,[m],o?void 0:t),u?.push(s);break}default:var K=Tt(m,e.options.actions),X=K.exec;if(o)o(K,s,n);else if(X&&u){var zt=u.length-1,Te=h(h({},K),{exec:function(mt){for(var ft=[],H=1;H<arguments.length;H++)ft[H-1]=arguments[H];X.apply(void 0,N([u[zt]],F(ft),!1))}});K=Te}return K}}function f(v){var m,b,w=[];try{for(var g=T(v.actions),S=g.next();!S.done;S=g.next()){var x=S.value,L=d(v.type,x);L&&(w=w.concat(L))}}catch(C){m={error:C}}finally{try{S&&!S.done&&(b=g.return)&&b.call(g)}finally{if(m)throw m.error}}return l.forEach(function(C){o(C,s,n)}),l.length=0,w}var p=j(i.map(f));return[p,s]}var ge=[],vt=function(e,t){ge.push(e);var r=t(e);return ge.pop(),r},br=function(e){return e(ge[ge.length-1])};function xr(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[nt]=function(){return this},t}function Tr(e,t,r,n){var i,o=ve(e.src),a=(i=t?.options.services)===null||i===void 0?void 0:i[o.type],c=e.data?St(e.data,r,n):void 0,s=a?we(a,e.id,c):xr(e.id);return s.meta=e,s}function we(e,t,r){var n=xr(t);if(n.deferred=!0,W(e)){var i=n.state=vt(void 0,function(){return(r?e.withContext(r):e).initialState});n.getSnapshot=function(){return i}}return n}function fn(e){try{return typeof e.send=="function"}catch{return!1}}function Er(e){return fn(e)&&"id"in e}function Fr(e){var t;return h((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},t[nt]=function(){return this},t),e)}var ee=function(e){return e.type==="atomic"||e.type==="final"};function Le(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function Ct(e){return Le(e).filter(function(t){return t.type!=="history"})}function Je(e){var t=[e];return ee(e)?t:t.concat(j(Ct(e).map(Je)))}function It(e,t){var r,n,i,o,a,c,s,u,l=new Set(e),d=je(l),f=new Set(t);try{for(var p=T(f),v=p.next();!v.done;v=p.next())for(var m=v.value,b=m.parent;b&&!f.has(b);)f.add(b),b=b.parent}catch(A){r={error:A}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}var w=je(f);try{for(var g=T(f),S=g.next();!S.done;S=g.next()){var m=S.value;if(m.type==="compound"&&(!w.get(m)||!w.get(m).length))d.get(m)?d.get(m).forEach(function(q){return f.add(q)}):m.initialStateNodes.forEach(function(q){return f.add(q)});else if(m.type==="parallel")try{for(var x=(a=void 0,T(Ct(m))),L=x.next();!L.done;L=x.next()){var C=L.value;f.has(C)||(f.add(C),d.get(C)?d.get(C).forEach(function(q){return f.add(q)}):C.initialStateNodes.forEach(function(q){return f.add(q)}))}}catch(q){a={error:q}}finally{try{L&&!L.done&&(c=x.return)&&c.call(x)}finally{if(a)throw a.error}}}}catch(A){i={error:A}}finally{try{S&&!S.done&&(o=g.return)&&o.call(g)}finally{if(i)throw i.error}}try{for(var _=T(f),I=_.next();!I.done;I=_.next())for(var m=I.value,b=m.parent;b&&!f.has(b);)f.add(b),b=b.parent}catch(A){s={error:A}}finally{try{I&&!I.done&&(u=_.return)&&u.call(_)}finally{if(s)throw s.error}}return f}function Pr(e,t){var r=t.get(e);if(!r)return{};if(e.type==="compound"){var n=r[0];if(n){if(ee(n))return n.key}else return{}}var i={};return r.forEach(function(o){i[o.key]=Pr(o,t)}),i}function je(e){var t,r,n=new Map;try{for(var i=T(e),o=i.next();!o.done;o=i.next()){var a=o.value;n.has(a)||n.set(a,[]),a.parent&&(n.has(a.parent)||n.set(a.parent,[]),n.get(a.parent).push(a))}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return n}function Or(e,t){var r=It([e],t);return Pr(e,je(r))}function jt(e,t){return Array.isArray(e)?e.some(function(r){return r===t}):e instanceof Set?e.has(t):!1}function Ar(e){return N([],F(new Set(j(N([],F(e.map(function(t){return t.ownEvents})),!1)))),!1)}function re(e,t){return t.type==="compound"?Ct(t).some(function(r){return r.type==="final"&&jt(e,r)}):t.type==="parallel"?Ct(t).every(function(r){return re(e,r)}):!1}function Dr(e){return e===void 0&&(e=[]),e.reduce(function(t,r){return r.meta!==void 0&&(t[r.id]=r.meta),t},{})}function Me(e){return new Set(j(e.map(function(t){return t.tags})))}function qe(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(P(e)||P(t))return e===t;var r=Object.keys(e),n=Object.keys(t);return r.length===n.length&&r.every(function(i){return qe(e[i],t[i])})}function _r(e){return typeof e!="object"||e===null?!1:"value"in e&&"_event"in e}function Nr(e,t){var r=e.exec,n=h(h({},e),{exec:r!==void 0?function(){return r(t.context,t.event,{action:e,state:t,_event:t._event})}:void 0});return n}var Q=function(){function e(t){var r=this,n;this.actions=[],this.activities=De,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||De,this.meta=Dr(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(n=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&n!==void 0?n:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return Ar(r.configuration)}})}return e.from=function(t,r){if(t instanceof e)return t.context!==r?new e({value:t.value,context:r,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var n=it;return new e({value:t,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,r){if(t instanceof e){if(!t.actions.length)return t;var n=it;return new e({value:t.value,context:r,_event:n,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,r)},e.prototype.toStrings=function(t,r){var n=this;if(t===void 0&&(t=this.value),r===void 0&&(r="."),P(t))return[t];var i=Object.keys(t);return i.concat.apply(i,N([],F(i.map(function(o){return n.toStrings(t[o],r).map(function(a){return o+r+a})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var r=t.tags;t.machine;var n=Ft(t,["configuration","transitions","tags","machine"]);return h(h({},n),{tags:Array.from(r)})},e.prototype.matches=function(t){return Gt(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var r;R&&M(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,t);return!!n?.transitions.length&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},e}();var dn={deferEvents:!1},ze=function(){function e(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=h(h({},dn),t)}return e.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},e.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},e.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},e}();var Be=new Map,hn=0,Lt={bookId:function(){return"x:".concat(hn++)},register:function(e,t){return Be.set(e,t),e},get:function(e){return Be.get(e)},free:function(e){Be.delete(e)}};function Se(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;R||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues")}function pn(){var e=Se();if(e&&"__xstate__"in e)return e.__xstate__}function Rr(e){if(Se()){var t=pn();t&&t.register(e)}}function kr(e,t){t===void 0&&(t={});var r=e.initialState,n=new Set,i=[],o=!1,a=function(){if(!o){for(o=!0;i.length>0;){var u=i.shift();r=e.transition(r,u,s),n.forEach(function(l){return l.next(r)})}o=!1}},c=Fr({id:t.id,send:function(u){i.push(u),a()},getSnapshot:function(){return r},subscribe:function(u,l,d){var f=Rt(u,l,d);return n.add(f),f.next(r),{unsubscribe:function(){n.delete(f)}}}}),s={parent:t.parent,self:c,id:t.id||"anonymous",observers:n};return r=e.start?e.start(s):r,c}var Ue={sync:!1,autoForward:!1},B;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(B||(B={}));var $r=function(){function e(t,r){r===void 0&&(r=e.defaultOptions);var n=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=B.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(l,d){if(lt(l))return n.batch(l),n.state;var f=z(Nt(l,d));if(n.status===B.Stopped)return R||M(!1,'Event "'.concat(f.name,'" was sent to stopped service "').concat(n.machine.id,`". This service has already reached its final state, and will not transition.
Event: `).concat(JSON.stringify(f.data))),n.state;if(n.status!==B.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(f.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(f.data)));return n.scheduler.schedule(function(){n.forward(f);var p=n._nextState(f);n.update(p,f)}),n._state},this.sendTo=function(l,d,f){var p=n.parent&&(d===et.Parent||n.parent.id===d),v=p?n.parent:P(d)?d===et.Internal?n:n.children.get(d)||Lt.get(d):sr(d)?d:void 0;if(!v){if(!p)throw new Error("Unable to send event to child '".concat(d,"' from service '").concat(n.id,"'."));R||M(!1,"Service '".concat(n.id,"' has no parent: unable to send event ").concat(l.type));return}if("machine"in v){if(n.status!==B.Stopped||n.parent!==v||n.state.done){var m=h(h({},l),{name:l.name===Kt?"".concat(yt(n.id)):l.name,origin:n.sessionId});!f&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([v,m]):v.send(m)}}else!f&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([v,l.data]):v.send(l.data)},this._exec=function(l,d,f,p){p===void 0&&(p=n.machine.options.actions);var v=l.exec||Qt(l.type,p),m=O(v)?v:v?v.exec:l.exec;if(m)try{return m(d,f.data,n.machine.config.predictableActionArguments?{action:l,_event:f}:{action:l,state:n.state,_event:f})}catch(X){throw n.parent&&n.parent.send({type:"xstate.error",data:X}),X}switch(l.type){case ut:{var b=l;n.defer(b);break}case dt:var w=l;if(typeof w.delay=="number"){n.defer(w);return}else w.to?n.sendTo(w._event,w.to,f===it):n.send(w._event);break;case Bt:n.cancel(l.sendId);break;case Pt:{if(n.status!==B.Running)return;var g=l.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[g.id||g.type])break;if(g.type===D.Invoke){var S=ve(g.src),x=n.machine.options.services?n.machine.options.services[S.type]:void 0,L=g.id,C=g.data;R||M(!("forward"in g),"`forward` property is deprecated (found in invocation of '".concat(g.src,"' in in machine '").concat(n.machine.id,"'). ")+"Please use `autoForward` instead.");var _="autoForward"in g?g.autoForward:!!g.forward;if(!x){R||M(!1,"No service found for invocation '".concat(g.src,"' in machine '").concat(n.machine.id,"'."));return}var I=C?St(C,d,f):void 0;if(typeof x=="string")return;var A=O(x)?x(d,f.data,{data:I,src:S,meta:g.meta}):x;if(!A)return;var q=void 0;W(A)&&(A=I?A.withContext(I):A,q={autoForward:_}),n.spawn(A,L,q)}else n.spawnActivity(g);break}case gt:{n.stopChild(l.activity.id);break}case Ot:var E=l,J=E.label,K=E.value;J?n.logger(J,K):n.logger(K);break;default:R||M(!1,"No implementation found for action type '".concat(l.type,"'"));break}};var i=h(h({},e.defaultOptions),r),o=i.clock,a=i.logger,c=i.parent,s=i.id,u=s!==void 0?s:t.id;this.id=u,this.logger=a,this.clock=o,this.parent=c,this.options=i,this.scheduler=new ze({deferEvents:this.options.deferEvents}),this.sessionId=Lt.bookId()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:vt(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return R||M(this.status!==B.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(t,r){var n,i;try{for(var o=T(t.actions),a=o.next();!a.done;a=o.next()){var c=a.value;this.exec(c,t,r)}}catch(s){n={error:s}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype.update=function(t,r){var n,i,o,a,c,s,u,l,d=this;if(t._sessionid=this.sessionId,this._state=t,(!this.machine.config.predictableActionArguments||r===it)&&this.options.execute)this.execute(this.state);else for(var f=void 0;f=this._outgoingQueue.shift();)f[0].send(f[1]);if(this.children.forEach(function(A){d.state.children[A.id]=A}),this.devTools&&this.devTools.send(r.data,t),t.event)try{for(var p=T(this.eventListeners),v=p.next();!v.done;v=p.next()){var m=v.value;m(t.event)}}catch(A){n={error:A}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}try{for(var b=T(this.listeners),w=b.next();!w.done;w=b.next()){var m=w.value;m(t,t.event)}}catch(A){o={error:A}}finally{try{w&&!w.done&&(a=b.return)&&a.call(b)}finally{if(o)throw o.error}}try{for(var g=T(this.contextListeners),S=g.next();!S.done;S=g.next()){var x=S.value;x(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(A){c={error:A}}finally{try{S&&!S.done&&(s=g.return)&&s.call(g)}finally{if(c)throw c.error}}if(this.state.done){var L=t.configuration.find(function(A){return A.type==="final"&&A.parent===d.machine}),C=L&&L.doneData?St(L.doneData,t.context,r):void 0;this._doneEvent=pt(this.id,C);try{for(var _=T(this.doneListeners),I=_.next();!I.done;I=_.next()){var m=I.value;m(this._doneEvent)}}catch(A){u={error:A}}finally{try{I&&!I.done&&(l=_.return)&&l.call(_)}finally{if(u)throw u.error}}this._stop(),this._stopChildren(),Lt.free(this.sessionId)}},e.prototype.onTransition=function(t){return this.listeners.add(t),this.status===B.Running&&t(this.state,this.state.event),this},e.prototype.subscribe=function(t,r,n){var i=this,o=Rt(t,r,n);this.listeners.add(o.next),this.status!==B.NotStarted&&o.next(this.state);var a=function(){i.doneListeners.delete(a),i.stopListeners.delete(a),o.complete()};return this.status===B.Stopped?o.complete():(this.onDone(a),this.onStop(a)),{unsubscribe:function(){i.listeners.delete(o.next),i.doneListeners.delete(a),i.stopListeners.delete(a)}}},e.prototype.onEvent=function(t){return this.eventListeners.add(t),this},e.prototype.onSend=function(t){return this.sendListeners.add(t),this},e.prototype.onChange=function(t){return this.contextListeners.add(t),this},e.prototype.onStop=function(t){return this.stopListeners.add(t),this},e.prototype.onDone=function(t){return this.status===B.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},e.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},e.prototype.start=function(t){var r=this;if(this.status===B.Running)return this;this.machine._init(),Lt.register(this.sessionId,this),this.initialized=!0,this.status=B.Running;var n=t===void 0?this.initialState:vt(this,function(){return _r(t)?r.machine.resolveState(t):r.machine.resolveState(Q.from(t,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,it)}),this},e.prototype._stopChildren=function(){this.children.forEach(function(t){O(t.stop)&&t.stop()}),this.children.clear()},e.prototype._stop=function(){var t,r,n,i,o,a,c,s,u,l;try{for(var d=T(this.listeners),f=d.next();!f.done;f=d.next()){var p=f.value;this.listeners.delete(p)}}catch(_){t={error:_}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}try{for(var v=T(this.stopListeners),m=v.next();!m.done;m=v.next()){var p=m.value;p(),this.stopListeners.delete(p)}}catch(_){n={error:_}}finally{try{m&&!m.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}try{for(var b=T(this.contextListeners),w=b.next();!w.done;w=b.next()){var p=w.value;this.contextListeners.delete(p)}}catch(_){o={error:_}}finally{try{w&&!w.done&&(a=b.return)&&a.call(b)}finally{if(o)throw o.error}}try{for(var g=T(this.doneListeners),S=g.next();!S.done;S=g.next()){var p=S.value;this.doneListeners.delete(p)}}catch(_){c={error:_}}finally{try{S&&!S.done&&(s=g.return)&&s.call(g)}finally{if(c)throw c.error}}if(!this.initialized)return this;this.initialized=!1,this.status=B.Stopped,this._initialState=void 0;try{for(var x=T(Object.keys(this.delayedEventsMap)),L=x.next();!L.done;L=x.next()){var C=L.value;this.clock.clearTimeout(this.delayedEventsMap[C])}}catch(_){u={error:_}}finally{try{L&&!L.done&&(l=x.return)&&l.call(x)}finally{if(u)throw u.error}}this.scheduler.clear(),this.scheduler=new ze({deferEvents:this.options.deferEvents})},e.prototype.stop=function(){var t=this,r=this.scheduler;return this._stop(),r.schedule(function(){var n=z({type:"xstate.stop"}),i=vt(t,function(){var o=j(N([],F(t.state.configuration),!1).sort(function(l,d){return d.order-l.order}).map(function(l){return rt(l.onExit,t.machine.options.actions)})),a=F(xt(t.machine,t.state,t.state.context,n,[{type:"exit",actions:o}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),c=a[0],s=a[1],u=new Q({value:t.state.value,context:s,_event:n,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:c.filter(function(l){return!Wt(l)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return u.changed=!0,u});t.update(i,n),t._stopChildren(),Lt.free(t.sessionId)}),this},e.prototype.batch=function(t){var r=this;if(this.status===B.NotStarted&&this.options.deferEvents)R||M(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,`" and are deferred. Make sure .start() is called for this service.
Event: `).concat(JSON.stringify(event)));else if(this.status!==B.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,o,a=r.state,c=!1,s=[],u=function(p){var v=z(p);r.forward(v),a=vt(r,function(){return r.machine.transition(a,v,void 0,n||void 0)}),s.push.apply(s,N([],F(r.machine.config.predictableActionArguments?a.actions:a.actions.map(function(m){return Nr(m,a)})),!1)),c=c||!!a.changed};try{for(var l=T(t),d=l.next();!d.done;d=l.next()){var f=d.value;u(f)}}catch(p){i={error:p}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}a.changed=c,a.actions=s,r.update(a,z(t[t.length-1]))})}},e.prototype.sender=function(t){return this.send.bind(this,t)},e.prototype._nextState=function(t,r){var n=this;r===void 0&&(r=!!this.machine.config.predictableActionArguments&&this._exec);var i=z(t);if(i.name.indexOf(ce)===0&&!this.state.nextEvents.some(function(a){return a.indexOf(ce)===0}))throw i.data.data;var o=vt(this,function(){return n.machine.transition(n.state,i,void 0,r||void 0)});return o},e.prototype.nextState=function(t){return this._nextState(t,!1)},e.prototype.forward=function(t){var r,n;try{for(var i=T(this.forwardTo),o=i.next();!o.done;o=i.next()){var a=o.value,c=this.children.get(a);if(!c)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(a,"'."));c.send(t)}}catch(s){r={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},e.prototype.defer=function(t){var r=this,n=this.clock.setTimeout(function(){"to"in t&&t.to?r.sendTo(t._event,t.to,!0):r.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=n)},e.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},e.prototype.exec=function(t,r,n){n===void 0&&(n=this.machine.options.actions),this._exec(t,r.context,r._event,n)},e.prototype.removeChild=function(t){var r;this.children.delete(t),this.forwardTo.delete(t),(r=this.state)===null||r===void 0||delete r.children[t]},e.prototype.stopChild=function(t){var r=this.children.get(t);r&&(this.removeChild(t),O(r.stop)&&r.stop())},e.prototype.spawn=function(t,r,n){if(this.status!==B.Running)return we(t,r);if(Ne(t))return this.spawnPromise(Promise.resolve(t),r);if(O(t))return this.spawnCallback(t,r);if(Er(t))return this.spawnActor(t,r);if(ar(t))return this.spawnObservable(t,r);if(W(t))return this.spawnMachine(t,h(h({},n),{id:r}));if(rr(t))return this.spawnBehavior(t,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof t,'".'))},e.prototype.spawnMachine=function(t,r){var n=this;r===void 0&&(r={});var i=new e(t,h(h({},this.options),{parent:this,id:r.id||t.id})),o=h(h({},Ue),r);o.sync&&i.onTransition(function(c){n.send(wt,{state:c,id:i.id})});var a=i;return this.children.set(i.id,a),o.autoForward&&this.forwardTo.add(i.id),i.onDone(function(c){n.removeChild(i.id),n.send(z(c,{origin:i.id}))}).start(),a},e.prototype.spawnBehavior=function(t,r){var n=kr(t,{id:r,parent:this});return this.children.set(r,n),n},e.prototype.spawnPromise=function(t,r){var n,i=this,o=!1,a;t.then(function(s){o||(a=s,i.removeChild(r),i.send(z(pt(r,s),{origin:r})))},function(s){if(!o){i.removeChild(r);var u=yt(r,s);try{i.send(z(u,{origin:r}))}catch(l){lr(s,l,r),i.devTools&&i.devTools.send(u,i.state),i.machine.strict&&i.stop()}}});var c=(n={id:r,send:function(){},subscribe:function(s,u,l){var d=Rt(s,u,l),f=!1;return t.then(function(p){f||(d.next(p),!f&&d.complete())},function(p){f||d.error(p)}),{unsubscribe:function(){return f=!0}}},stop:function(){o=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return a}},n[nt]=function(){return this},n);return this.children.set(r,c),c},e.prototype.spawnCallback=function(t,r){var n,i=this,o=!1,a=new Set,c=new Set,s,u=function(f){s=f,c.forEach(function(p){return p(f)}),!o&&i.send(z(f,{origin:r}))},l;try{l=t(u,function(f){a.add(f)})}catch(f){this.send(yt(r,f))}if(Ne(l))return this.spawnPromise(l,r);var d=(n={id:r,send:function(f){return a.forEach(function(p){return p(f)})},subscribe:function(f){var p=Rt(f);return c.add(p.next),{unsubscribe:function(){c.delete(p.next)}}},stop:function(){o=!0,O(l)&&l()},toJSON:function(){return{id:r}},getSnapshot:function(){return s}},n[nt]=function(){return this},n);return this.children.set(r,d),d},e.prototype.spawnObservable=function(t,r){var n,i=this,o,a=t.subscribe(function(s){o=s,i.send(z(s,{origin:r}))},function(s){i.removeChild(r),i.send(z(yt(r,s),{origin:r}))},function(){i.removeChild(r),i.send(z(pt(r),{origin:r}))}),c=(n={id:r,send:function(){},subscribe:function(s,u,l){return t.subscribe(s,u,l)},stop:function(){return a.unsubscribe()},getSnapshot:function(){return o},toJSON:function(){return{id:r}}},n[nt]=function(){return this},n);return this.children.set(r,c),c},e.prototype.spawnActor=function(t,r){return this.children.set(r,t),t},e.prototype.spawnActivity=function(t){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!r){R||M(!1,"No implementation found for activity '".concat(t.type,"'"));return}var n=r(this.state.context,t);this.spawnEffect(t.id,n)},e.prototype.spawnEffect=function(t,r){var n;this.children.set(t,(n={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}},n[nt]=function(){return this},n))},e.prototype.attachDev=function(){var t=Se();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(h(h({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:h({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}Rr(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[nt]=function(){return this},e.prototype.getSnapshot=function(){return this.status===B.NotStarted?this.initialState:this._state},e.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,r){return setTimeout(t,r)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},e.interpret=be,e}(),yn=function(e){return P(e)?h(h({},Ue),{name:e}):h(h(h({},Ue),{name:cr()}),e)};function Ke(e,t){var r=yn(t);return br(function(n){if(!R){var i=W(e)||O(e);M(!!n||i,'Attempted to spawn an Actor (ID: "'.concat(W(e)?e.id:"undefined",'") outside of a service. This will have no effect.'))}return n?n.spawn(e,r.name,r):we(e,r.name)})}function be(e,t){var r=new $r(e,t);return r}function vn(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function ne(e){return h(h({type:At},e),{toJSON:function(){e.onDone,e.onError;var t=Ft(e,["onDone","onError"]);return h(h({},t),{type:At,src:vn(e.src)})}})}var qt="",Ve="#",ie="*",Jt={},Mt=function(e){return e[0]===Ve},mn=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},gn=function(e,t,r){var n=r.slice(0,-1).some(function(o){return!("cond"in o)&&!("in"in o)&&(P(o.target)||W(o.target))}),i=t===qt?"the transient event":"event '".concat(t,"'");M(!n,"One or more transitions for ".concat(i," on state '").concat(e.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},Cr=function(){function e(t,r,n,i){n===void 0&&(n="context"in t?t.context:void 0);var o=this,a;this.config=t,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(mn(),r),this.parent=i?.parent,this.key=this.config.key||i?.key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:ue),this.id=this.config.id||N([this.machine.key],F(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(a=this.config.schema)!==null&&a!==void 0?a:{},this.description=this.config.description,R||M(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?_t(this.config.states,function(u,l){var d,f=new e(u,{},void 0,{parent:o,key:l});return Object.assign(o.idMap,h((d={},d[f.id]=f,d),f.idMap)),f}):Jt;var c=0;function s(u){var l,d;u.order=c++;try{for(var f=T(Le(u)),p=f.next();!p.done;p=f.next()){var v=p.value;s(v)}}catch(m){l={error:m}}finally{try{p&&!p.done&&(d=f.return)&&d.call(f)}finally{if(l)throw l.error}}}s(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(u){var l=u.event;return l===qt}):qt in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Y(this.config.entry||this.config.onEntry).map(function(u){return Tt(u)}),this.onExit=Y(this.config.exit||this.config.onExit).map(function(u){return Tt(u)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Y(this.config.invoke).map(function(u,l){var d,f;if(W(u)){var p=Yt(o.id,l);return o.machine.options.services=h((d={},d[p]=u,d),o.machine.options.services),ne({src:p,id:p})}else if(P(u.src)){var p=u.id||Yt(o.id,l);return ne(h(h({},u),{id:p,src:u.src}))}else if(W(u.src)||O(u.src)){var p=u.id||Yt(o.id,l);return o.machine.options.services=h((f={},f[p]=u.src,f),o.machine.options.services),ne(h(h({id:p},u),{src:p}))}else{var v=u.src;return ne(h(h({id:Yt(o.id,l)},u),{src:v}))}}),this.activities=Y(this.config.activities).concat(this.invoke).map(function(u){return Ht(u)}),this.transition=this.transition.bind(this),this.tags=Y(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||Je(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,r){var n=this.options,i=n.actions,o=n.activities,a=n.guards,c=n.services,s=n.delays;return new e(this.config,{actions:h(h({},i),t.actions),activities:h(h({},o),t.activities),guards:h(h({},a),t.guards),services:h(h({},c),t.services),delays:h(h({},s),t.delays)},r??this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return O(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:_t(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var r=t===qt,n=this.transitions.filter(function(i){var o=i.eventType===t;return r?o:o||i.eventType===ie});return this.__cache.candidates[t]=n,n},e.prototype.getDelayedTransitions=function(){var t=this,r=this.config.after;if(!r)return[];var n=function(o,a){var c=O(o)?"".concat(t.id,":delay[").concat(a,"]"):o,s=Ie(c,t.id);return t.onEntry.push(ht(s,{delay:o})),t.onExit.push($e(s)),s},i=lt(r)?r.map(function(o,a){var c=n(o.delay,a);return h(h({},o),{event:c})}):j(Object.keys(r).map(function(o,a){var c=r[o],s=P(c)?{target:c}:c,u=isNaN(+o)?o:+o,l=n(u,a);return Y(s).map(function(d){return h(h({},d),{event:l,delay:u})})}));return i.map(function(o){var a=o.delay;return h(h({},t.formatTransition(o)),{delay:a})})},e.prototype.getStateNodes=function(t){var r,n=this;if(!t)return[];var i=t instanceof Q?t.value:Dt(t,this.delimiter);if(P(i)){var o=this.getStateNode(i).initial;return o!==void 0?this.getStateNodes((r={},r[i]=o,r)):[this,this.states[i]]}var a=Object.keys(i),c=[this];return c.push.apply(c,N([],F(j(a.map(function(s){return n.getStateNode(s).getStateNodes(i[s])}))),!1)),c},e.prototype.handles=function(t){var r=de(t);return this.events.includes(r)},e.prototype.resolveState=function(t){var r=t instanceof Q?t:Q.create(t),n=Array.from(It([],this.getStateNodes(r.value)));return new Q(h(h({},r),{value:this.resolve(r.value),configuration:n,done:re(n,this),tags:Me(n),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,r,n){var i=this.getStateNode(t),o=i.next(r,n);return!o||!o.transitions.length?this.next(r,n):o},e.prototype.transitionCompoundNode=function(t,r,n){var i=Object.keys(t),o=this.getStateNode(i[0]),a=o._transition(t[i[0]],r,n);return!a||!a.transitions.length?this.next(r,n):a},e.prototype.transitionParallelNode=function(t,r,n){var i,o,a={};try{for(var c=T(Object.keys(t)),s=c.next();!s.done;s=c.next()){var u=s.value,l=t[u];if(l){var d=this.getStateNode(u),f=d._transition(l,r,n);f&&(a[u]=f)}}}catch(w){i={error:w}}finally{try{s&&!s.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}var p=Object.keys(a).map(function(w){return a[w]}),v=j(p.map(function(w){return w.transitions})),m=p.some(function(w){return w.transitions.length>0});if(!m)return this.next(r,n);var b=j(Object.keys(a).map(function(w){return a[w].configuration}));return{transitions:v,exitSet:j(p.map(function(w){return w.exitSet})),configuration:b,source:r,actions:j(Object.keys(a).map(function(w){return a[w].actions}))}},e.prototype._transition=function(t,r,n){return P(t)?this.transitionLeafNode(t,r,n):Object.keys(t).length===1?this.transitionCompoundNode(t,r,n):this.transitionParallelNode(t,r,n)},e.prototype.getTransitionData=function(t,r){return this._transition(t.value,t,z(r))},e.prototype.next=function(t,r){var n,i,o=this,a=r.name,c=[],s=[],u;try{for(var l=T(this.getCandidates(a)),d=l.next();!d.done;d=l.next()){var f=d.value,p=f.cond,v=f.in,m=t.context,b=v?P(v)&&Mt(v)?t.matches(Dt(this.getStateNodeById(v).path,this.delimiter)):Gt(Dt(v,this.delimiter),He(this.path.slice(0,-2))(t.value)):!0,w=!1;try{w=!p||ye(this.machine,p,m,r,t)}catch(x){throw new Error("Unable to evaluate guard '".concat(p.name||p.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,`':
`).concat(x.message))}if(w&&b){f.target!==void 0&&(s=f.target),c.push.apply(c,N([],F(f.actions),!1)),u=f;break}}}catch(x){n={error:x}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}if(u){if(!s.length)return{transitions:[u],exitSet:[],configuration:t.value?[this]:[],source:t,actions:c};var g=j(s.map(function(x){return o.getRelativeStateNodes(x,t.historyValue)})),S=!!u.internal;return{transitions:[u],exitSet:S?[]:j(s.map(function(x){return o.getPotentiallyReenteringNodes(x)})),configuration:g,source:t,actions:c}}},e.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var r=[],n=this,i=t;n&&n!==i;)r.push(n),n=n.parent;return n!==i?[]:(r.push(i),r)},e.prototype.getActions=function(t,r,n,i,o,a,c){var s,u,l,d,f=this,p=a?It([],this.getStateNodes(a.value)):[],v=new Set;try{for(var m=T(Array.from(t).sort(function(E,J){return E.order-J.order})),b=m.next();!b.done;b=m.next()){var w=b.value;(!jt(p,w)||jt(n.exitSet,w)||w.parent&&v.has(w.parent))&&v.add(w)}}catch(E){s={error:E}}finally{try{b&&!b.done&&(u=m.return)&&u.call(m)}finally{if(s)throw s.error}}try{for(var g=T(p),S=g.next();!S.done;S=g.next()){var w=S.value;(!jt(t,w)||jt(n.exitSet,w.parent))&&n.exitSet.push(w)}}catch(E){l={error:E}}finally{try{S&&!S.done&&(d=g.return)&&d.call(g)}finally{if(l)throw l.error}}n.exitSet.sort(function(E,J){return J.order-E.order});var x=Array.from(v).sort(function(E,J){return E.order-J.order}),L=new Set(n.exitSet),C=j(x.map(function(E){var J=[];if(E.type!=="final")return J;var K=E.parent;if(!K.parent)return J;J.push(kt(E.id,E.doneData),kt(K.id,E.doneData?St(E.doneData,i,o):void 0));var X=K.parent;return X.type==="parallel"&&Ct(X).every(function(zt){return re(n.configuration,zt)})&&J.push(kt(X.id)),J})),_=x.map(function(E){var J=E.onEntry,K=E.activities.map(function(X){return Ce(X)});return{type:"entry",actions:rt(c?N(N([],F(J),!1),F(K),!1):N(N([],F(K),!1),F(J),!1),f.machine.options.actions)}}).concat({type:"state_done",actions:C.map(function(E){return Zt(E)})}),I=Array.from(L).map(function(E){return{type:"exit",actions:rt(N(N([],F(E.onExit),!1),F(E.activities.map(function(J){return me(J)})),!1),f.machine.options.actions)}}),A=I.concat({type:"transition",actions:rt(n.actions,this.machine.options.actions)}).concat(_);if(r){var q=rt(j(N([],F(t),!1).sort(function(E,J){return J.order-E.order}).map(function(E){return E.onExit})),this.machine.options.actions).filter(function(E){return!Wt(E)});return A.concat({type:"stop",actions:q})}return A},e.prototype.transition=function(t,r,n,i){t===void 0&&(t=this.initialState);var o=z(r),a;if(t instanceof Q)a=n===void 0?t:this.resolveState(Q.from(t,n));else{var c=P(t)?this.resolve(Vt(this.getResolvedPath(t))):this.resolve(t),s=n??this.machine.context;a=this.resolveState(Q.from(c,s))}if(!R&&o.name===ie)throw new Error("An event cannot have the wildcard type ('".concat(ie,"')"));if(this.strict&&!this.events.includes(o.name)&&!er(o.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(o.name,"'"));var u=this._transition(a.value,a,o)||{transitions:[],configuration:[],exitSet:[],source:a,actions:[]},l=It([],this.getStateNodes(a.value)),d=u.configuration.length?It(l,u.configuration):l;return u.configuration=N([],F(d),!1),this.resolveTransition(u,a,a.context,i,o)},e.prototype.resolveRaisedTransition=function(t,r,n,i){var o,a=t.actions;return t=this.transition(t,r,void 0,i),t._event=n,t.event=n.data,(o=t.actions).unshift.apply(o,N([],F(a),!1)),t},e.prototype.resolveTransition=function(t,r,n,i,o){var a,c,s,u,l=this;o===void 0&&(o=it);var d=t.configuration,f=!r||t.transitions.length>0,p=f?t.configuration:r?r.configuration:[],v=re(p,this),m=f?Or(this.machine,d):void 0,b=r?r.historyValue?r.historyValue:t.source?this.machine.historyValue(r.value):void 0:void 0,w=this.getActions(new Set(p),v,t,n,o,r,i),g=r?h({},r.activities):{};try{for(var S=T(w),x=S.next();!x.done;x=S.next()){var L=x.value;try{for(var C=(s=void 0,T(L.actions)),_=C.next();!_.done;_=C.next()){var I=_.value;I.type===Pt?g[I.activity.id||I.activity.type]=I:I.type===gt&&(g[I.activity.id||I.activity.type]=!1)}}catch(tt){s={error:tt}}finally{try{_&&!_.done&&(u=C.return)&&u.call(C)}finally{if(s)throw s.error}}}}catch(tt){a={error:tt}}finally{try{x&&!x.done&&(c=S.return)&&c.call(S)}finally{if(a)throw a.error}}var A=F(xt(this,r,n,o,w,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),q=A[0],E=A[1],J=F(nr(q,Wt),2),K=J[0],X=J[1],zt=q.filter(function(tt){var Et;return tt.type===Pt&&((Et=tt.activity)===null||Et===void 0?void 0:Et.type)===At}),Te=zt.reduce(function(tt,Et){return tt[Et.activity.id]=Tr(Et.activity,l.machine,E,o),tt},r?h({},r.children):{}),mt=new Q({value:m||r.value,context:E,_event:o,_sessionid:r?r._sessionid:null,historyValue:m?b?or(b,m):void 0:r?r.historyValue:void 0,history:!m||t.source?r:void 0,actions:m?X:[],activities:m?g:r?r.activities:{},events:[],configuration:p,transitions:t.transitions,children:Te,done:v,tags:Me(p),machine:this}),ft=n!==E;mt.changed=o.name===wt||ft;var H=mt.history;H&&delete H.history;var Xe=!v&&(this._transient||d.some(function(tt){return tt._transient}));if(!f&&(!Xe||o.name===qt))return mt;var Z=mt;if(!v)for(Xe&&(Z=this.resolveRaisedTransition(Z,{type:Ee},o,i));K.length;){var Wr=K.shift();Z=this.resolveRaisedTransition(Z,Wr._event,o,i)}var Qr=Z.changed||(H?!!Z.actions.length||ft||typeof H.value!=typeof Z.value||!qe(Z.value,H.value):void 0);return Z.changed=Qr,Z.history=H,Z},e.prototype.getStateNode=function(t){if(Mt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[t];if(!r)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return r},e.prototype.getStateNodeById=function(t){var r=Mt(t)?t.slice(Ve.length):t;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&Mt(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var r=he(t,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},e.prototype.resolve=function(t){var r,n=this;if(!t)return this.initialStateValue||Jt;switch(this.type){case"parallel":return _t(this.initialStateValue,function(o,a){return o?n.getStateNode(a).resolve(t[a]||o):Jt});case"compound":if(P(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(r={},r[t]=i.initialStateValue,r):t}return Object.keys(t).length?_t(t,function(o,a){return o?n.getStateNode(a).resolve(o):Jt}):this.initialStateValue||{};default:return t||Jt}},e.prototype.getResolvedPath=function(t){if(Mt(t)){var r=this.machine.idMap[t.slice(Ve.length)];if(!r)throw new Error("Unable to find state node '".concat(t,"'"));return r.path}return he(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=_e(this.states,function(n){return n.initialStateValue||Jt},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=ee(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,r){this._init();var n=this.getStateNodes(t);return this.resolveTransition({configuration:n,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r??this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var r=this.config;P(r.target)?t=Mt(r.target)?Vt(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:t=r.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,r,n){return n===void 0&&(n=!0),n?t.type==="history"?t.resolveHistory(r):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(ee(this))return[this];if(this.type==="compound"&&!this.initial)return R||M(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var r=Xt(this.initialStateValue);return j(r.map(function(n){return t.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var r=F(t),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var o=this.getStateNode(n);if(o.type==="history")return o.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},e.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:_e(this.states,function(r,n){if(!t)return r.historyValue();var i=P(t)?void 0:t[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},e.prototype.resolveHistory=function(t){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!t){var i=this.target;return i?j(Xt(i).map(function(a){return n.getFromRelativePath(a)})):n.initialStateNodes}var o=Ze(n.path,"states")(t).current;return P(o)?[n.getStateNode(o)]:j(Xt(o).map(function(a){return r.history==="deep"?n.getFromRelativePath(a):[n.states[a[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,r=j(Object.keys(this.states).map(function(n){return t.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,r,n,i;if(this.__cache.events)return this.__cache.events;var o=this.states,a=new Set(this.ownEvents);if(o)try{for(var c=T(Object.keys(o)),s=c.next();!s.done;s=c.next()){var u=s.value,l=o[u];if(l.states)try{for(var d=(n=void 0,T(l.events)),f=d.next();!f.done;f=d.next()){var p=f.value;a.add("".concat(p))}}catch(v){n={error:v}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}}}catch(v){t={error:v}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var r=this;if(t!==void 0)return t.map(function(n){if(!P(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var o=i?r.key+n:n;if(r.parent)try{var a=r.parent.getStateNodeByPath(o);return a}catch(c){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(c.message))}else return r.getStateNodeByPath(o)})},e.prototype.formatTransition=function(t){var r=this,n=ur(t.target),i="internal"in t?t.internal:n?n.some(function(s){return P(s)&&s[0]===r.delimiter}):!0,o=this.machine.options.guards,a=this.resolveTarget(n),c=h(h({},t),{actions:rt(Y(t.actions)),cond:pe(t.cond,o),target:a,source:this,internal:i,eventType:t.event,toJSON:function(){return h(h({},c),{target:c.target?c.target.map(function(s){return"#".concat(s.id)}):void 0,source:"#".concat(r.id)})}});return c},e.prototype.formatTransitions=function(){var t,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var o=this.config.on,a=ie,c=o[a],s=c===void 0?[]:c,u=Ft(o,[typeof a=="symbol"?a:a+""]);i=j(Object.keys(u).map(function(g){!R&&g===qt&&M(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(n.id,'".'));var S=bt(g,u[g]);return R||gn(n,g,S),S}).concat(bt(ie,s)))}var l=this.config.always?bt("",this.config.always):[],d=this.config.onDone?bt(String(kt(this.id)),this.config.onDone):[];R||M(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var f=j(this.invoke.map(function(g){var S=[];return g.onDone&&S.push.apply(S,N([],F(bt(String(pt(g.id)),g.onDone)),!1)),g.onError&&S.push.apply(S,N([],F(bt(String(yt(g.id)),g.onError)),!1)),S})),p=this.after,v=j(N(N(N(N([],F(d),!1),F(f),!1),F(i),!1),F(l),!1).map(function(g){return Y(g).map(function(S){return n.formatTransition(S)})}));try{for(var m=T(p),b=m.next();!b.done;b=m.next()){var w=b.value;v.push(w)}}catch(g){t={error:g}}finally{try{b&&!b.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}return v},e}();var Ir=!1;function oe(e,t){return!R&&!("predictableActionArguments"in e)&&!Ir&&(Ir=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Cr(e,t)}var k=ke,$=te;var xe=Zt;function ot(e,t,r,n){let i=V(r,G(t));return new Promise((o,a)=>{let c=e.transaction("lock","readwrite").objectStore("lock"),s=Date.now(),u=c.add({pathPrefix:i,expiry:s+n,createdAt:s});u.onsuccess=l=>{o(l.target.result)},u.onerror=l=>{console.log(`lock acquisition error: ${l.target.error}`),a(`Could not acquire lock for path prefix ${i}`)}})}function at(e,t){return new Promise(r=>{let i=e.transaction("lock","readwrite").objectStore("lock").delete(t);i.onsuccess=()=>{r(1)},i.onerror=()=>{r(0)}})}function jr(e,t){return new Promise((r,n)=>{let o=e.transaction("content","readonly").objectStore("content").get(IDBKeyRange.only(t.path));o.onsuccess=a=>{r({...t,content:a.target.result.content||null})},o.onerror=a=>{r({...t,content:null})}})}function U(e,t,r){let n=V(r,G(t));return new Promise((i,o)=>{let c=e.transaction("entity","readonly").objectStore("entity").get(n);c.onsuccess=s=>{s.target.result?i(s.target.result):o(`Could not find entity with path ${n}`)},c.onerror=()=>{o(`Could not get entity with path ${n}.`)}})}function Lr(e,t,r){let n=V(r,G(t));return U(e,t,n).then(i=>{if(i.isLeaf)throw"Not a directory";return new Promise((o,a)=>{let u=e.transaction("entity","readonly").objectStore("entity").index("parentPath").getAllKeys(IDBKeyRange.only(i.path));u.onsuccess=l=>{o(l.target.result)},u.onerror=()=>{a(`Could not get child keys of directory with path ${n}.`)}})})}function wn(e,t,r,n){let i=V(r,G(t));return new Promise((o,a)=>{let s=e.transaction("content","readwrite").objectStore("content").put({content:n,leafPath:r});s.onsuccess=u=>{o({leafPath:u.target.result})},s.onerror=()=>{a(`Could not insert content record for leaf with path ${r}.`)}})}function Sn(e,t,r,n){let i=V(r,G(t));return new Promise((o,a)=>{let s=e.transaction("content","readwrite").objectStore("content").openCursor(IDBKeyRange.only(i)),u=0;s.onsuccess=l=>{let d=l.target.result;if(d){let f=d.value;f.content=n,u+=1,d.update(f),d.continue()}else o({contentUpdates:u})},s.onerror=()=>{a(`Could not update content record for leaf with n ${i}.`)}})}function Jr(e,t,r){let n=V(r,G(t));return new Promise((i,o)=>{let c=e.transaction("content","readwrite").objectStore("content").openCursor(IDBKeyRange.only(n)),s=0;c.onsuccess=u=>{let l=u.target.result;l?(s+=1,l.delete(),l.continue()):i({contentDeletes:s})},c.onerror=()=>{o(`Could not delete content record for leaf with id ${leafId}.`)}})}function st(e,t,r,n=!0){return Promise.all(r.map(i=>U(e,t,i))).then(i=>new Promise((o,a)=>{let c=i.map(d=>d.path),u=e.transaction("lock","readonly").objectStore("lock").index("expiry"),l=n?u.getAll(IDBKeyRange.lowerBound(Date.now())):u.getAll();l.onsuccess=d=>{let p=d.target.result.filter(v=>!c.includes(v.pathPrefix)).reduce((v,m)=>c.reduce((b,w)=>w.startsWith(m.pathPrefix)?v+1:v,0)?v+1:v,0);p?a(`Just acquired locks conflict with prefixes of ${p} other locks. Considering only unexpired locks: ${n+""}.`):o(`No conflicting locks found. Considering only unexpired locks: ${n+""}.`)},l.onerror=()=>{a("Could not get comparison locks for conflict detection.")}}))}function Mr(e,t,r,n,i){let o=V(n,G(t));return U(e,t,o).then(a=>new Promise((c,s)=>{a.isLeaf&&s("Cannot designate leaf entity as parent of another leaf entity."),/^[a-zA-Z0-9_.-]+$/.test(r)||s(`Invalid file name: ${r}. File names must be alphanumeric, dashes, dots, and underscores.`);let u=V(a.path+r,G(t)),l=Date.now(),f=e.transaction("entity","readwrite").objectStore("entity").add({path:u,isLeaf:!0,parentPath:a.path,createdAt:l,updatedAt:l,name:r});f.onsuccess=p=>{c(p.target.result)},f.onerror=p=>{s(`Could not add file entity with name ${r} to parent ${a.path}: ${p.target.error.message}`)}})).then(a=>wn(e,t,a,i))}function qr(e,t,r,n){let i=V(n,G(t));return U(e,t,i).then(o=>new Promise((a,c)=>{console.log(`parentPath ${o.path} name ${r}`);let s=V(o.path+r+"/",G(t));console.log(`n2 ${s}`);let u=Date.now(),l=e.transaction("entity","readwrite").objectStore("entity");console.log(JSON.stringify({path:s,isLeaf:!1,parentPath:o.path,createdAt:u,updatedAt:u,name:r}));let d=l.add({path:s,isLeaf:!1,parentPath:o.path,createdAt:u,updatedAt:u,name:r});d.onsuccess=f=>{a(f.target.result)},d.onerror=f=>{c(`Could not add directory entity with name ${r} to parent ${o.path}.`)}}))}function zr(e,t,r){let n=V(r,G(t));return new Promise((i,o)=>{let c=e.transaction("entity","readwrite").objectStore("entity").delete(n);c.onsuccess=()=>{i(n)},c.onerror=()=>{o(`Could not delete entity with path ${r}; it may have already been deleted.`)}})}function Br(e,t,r){return U(e,t,r).then(n=>{if(!n.isLeaf)throw`Cannot delete non-leaf entity with path ${n.path}.`;return zr(e,t,r)}).then(n=>Jr(e,t,n))}function Ur(e,t,r){return U(e,t,r).then(n=>new Promise((i,o)=>{n.isLeaf&&o(`Cannot delete entity with path ${n.path} because it is a leaf.`),n.path==="/"&&o(`Cannot delete entity with path ${n.path} because it is the root directory.`),t.startsWith(n.path)&&o(`Cannot delete entity with path ${n.path} because it is a prefix of the current working directory.`);let s=e.transaction("entity","readwrite").objectStore("entity").index("parentPath").count(IDBKeyRange.only(n.path));s.onsuccess=()=>{s.result!==0&&o(`Cannot delete directory with path ${n.path} because it is not empty.`),i(n.path)},s.onerror=()=>{o(`Could not count number of children for directory with path ${n.path}.`)}})).then(n=>zr(e,t,n))}function Kr(e,t,r){return U(e,t,r).then(n=>new Promise((i,o)=>{n.isLeaf&&o(`Cannot empty entity with path ${n.path} because it is a leaf.`);let s=e.transaction("entity","readwrite").objectStore("entity").index("parentPath").count(IDBKeyRange.only(n.path));s.onsuccess=()=>{s.result===0&&o(`Cannot empty entity with path ${n.path} because it is already empty.`),i(n.path)},s.onerror=()=>{o(`Could not count number of children for directory with path ${n.path}.`)}})).then(n=>new Promise((i,o)=>{let c=e.transaction("entity","readwrite").objectStore("entity").openCursor(IDBKeyRange.bound(n,n+"\uFFFF",!0,!1)),s=[];var u=0;c.onsuccess=l=>{let d=l.target.result;d?(d.value.isLeaf&&s.push(d.value.path),d.delete(),u++,d.continue()):i(s)},c.onerror=()=>{o(`Could not empty directory with path ${n}.`)}})).then(n=>Promise.allSettled(n.map(i=>Jr(e,t,i))))}function Ge(e,t,r){return U(e,t,r).then(n=>new Promise((i,o)=>{n.isLeaf||o(`Entity with path ${n.path} is not a leaf entity.`);let a=Date.now(),s=e.transaction("entity","readwrite").objectStore("entity").openCursor(IDBKeyRange.only(n.path));var u=0;s.onsuccess=l=>{let d=l.target.result;if(d){let f=d.value;f.updatedAt=a,d.update(f),++u,d.continue()}else i(u)},s.onerror=()=>{o(`Could not update file with path ${n.path}.`)}}))}function Vr(e,t,r,n){return U(e,t,r).then(i=>Promise.allSettled([Ge(e,t,r),Sn(e,t,r,n)]))}function Gr(e){return new Promise((t,r)=>{let i=e.transaction("lock","readonly").objectStore("lock").index("expiry").getAllKeys(IDBKeyRange.upperBound(Date.now()));i.onsuccess=o=>{t(o.target.result)},i.onerror=()=>{r("Error reading expired locks.")}}).then(t=>Promise.allSettled(t.map(r=>new Promise((n,i)=>{let a=e.transaction("lock","readwrite").objectStore("lock").delete(r);a.onsuccess=()=>{n("Expired lock pruned succesfully.")},a.onerror=()=>{i("Error deleting expired lock by path; it may have already been deleted.")}}))))}var{assign:ae,log:se}=$t,bn=oe({predictableActionArguments:!0,initial:"uninitialized",context:{cwd:"/",fsName:null},states:{uninitialized:{initial:"idle",states:{idle:{on:{init:{target:"initializing",cond:(e,t)=>typeof t.filesystemName=="string"&&typeof t.version=="number",actions:ae((e,t)=>({...e,fsName:t.filesystemName,version:t.version}))},listFilesystems:{target:"listingFilesystems"},dropFilesystem:{target:"droppingFilesystem"},restoreFilesystemFromJSON:{target:"restoringFilesystemFromJSON"}}},listingFilesystems:{invoke:{src:()=>indexedDB.databases(),onDone:{target:"idle",actions:[$((e,t)=>({type:"listFilesystemsSuccess",filesystems:t.data}))]},onError:{target:"idle",actions:[$((e,t)=>({type:"listFilesystemsFailure",error:t.data}))]}}},droppingFilesystem:{invoke:{src:(e,t)=>new Promise((r,n)=>{let i=indexedDB.deleteDatabase(t.fsName);i.onsuccess=()=>{r()},i.onerror=()=>{n(i.error)}}),onDone:{target:"idle",actions:[$(()=>({type:"dropFilesystemSuccess"}))]},onError:{target:"idle",actions:[$((e,t)=>({type:"dropFilesystemFailure",error:t.data}))]}}},restoringFilesystemFromJSON:{invoke:{src:(e,t)=>Promise.resolve(typeof indexedDB.databases<"u"?indexedDB.databases():[]).then(r=>new Promise((n,i)=>{typeof indexedDB.databases<"u"&&r.includes(t.fsName)&&i("Filesystem with provided name already exists");let o=window.indexedDB.open(t.fsName,t.version);o.onsuccess=a=>{db=a.target.result,n(db)},o.onerror=()=>{i()},o.onupgradeneeded=a=>{let c=a.target.result,s=c.createObjectStore("entity",{keyPath:"path"});s.createIndex("name","name"),s.createIndex("parentPath","parentPath"),s.createIndex("createdAt","createdAt"),s.createIndex("updatedAt","updatedAt"),s.createIndex("uniqueParentChild",["parentPath","name"],{unique:!0});let u=c.createObjectStore("lock",{keyPath:"pathPrefix"});u.createIndex("expiry","expiry"),u.createIndex("createdAt","createdAt");let l=c.createObjectStore("content",{keyPath:"leafPath"})}})).then(r=>{let{entity:n,lock:i,content:o}=JSON.parse(t.backup);return Promise.all([Promise.all(n.map(a=>new Promise((c,s)=>{let l=r.transaction("entity","readwrite").objectStore("entity").put(a);l.onsuccess=c,l.onerror=s}))),Promise.all(o.map(a=>new Promise((c,s)=>{let l=r.transaction("content","readwrite").objectStore("content").put(a);l.onsuccess=c,l.onerror=s}))),Promise.all(i.map(a=>new Promise((c,s)=>{let l=r.transaction("lock","readwrite").objectStore("lock").put(a);l.onsuccess=c,l.onerror=s})))])}),onDone:{target:"idle",actions:[$("restoreFilesystemFromJSONSuccess")]},onError:{target:"idle",actions:[$("restoreFilesystemFromJSONFailure")]}}},initializing:{invoke:{src:e=>new Promise((t,r)=>{let n=window.indexedDB.open(e.fsName,e.version);n.onsuccess=i=>{db=i.target.result,t(db)},n.onerror=()=>{r()},n.onupgradeneeded=i=>{let o=i.target.result,a=o.createObjectStore("entity",{keyPath:"path"});a.createIndex("name","name"),a.createIndex("parentPath","parentPath"),a.createIndex("createdAt","createdAt"),a.createIndex("updatedAt","updatedAt"),a.createIndex("uniqueParentChild",["parentPath","name"],{unique:!0});let c=o.createObjectStore("lock",{keyPath:"pathPrefix"});c.createIndex("expiry","expiry"),c.createIndex("createdAt","createdAt");let s=o.createObjectStore("content",{keyPath:"leafPath"})}}),onDone:{target:"seeding",actions:[ae((e,t)=>({...e,db:t.data}))]},onError:{target:"idle",actions:[se("Failed to initialize filesystem."),se((e,t)=>t.toString())]}}},seeding:{invoke:{src:e=>new Promise((t,r)=>{let{db:n}=e,i=n.transaction(["entity"],"readwrite").objectStore("entity"),o=Date.now(),a=i.add({name:"",path:"/",isLeaf:!1,parentPath:null,createdAt:o,updatedAt:o});a.onsuccess=()=>{t()},a.onerror=c=>{let s=c.target.error.name;s==="ConstraintError"?t():r(s)}}),onDone:{target:"done",actions:[]},onError:{target:"idle",actions:[se("Attempt to conditionally seed root directory / failed and it was not a unique constraint violation."),se((e,t)=>t.toString())]}}},done:{type:"final"}},onDone:"initialized"},initialized:{type:"parallel",states:{lockTablePruner:{initial:"idle",states:{idle:{on:{pruneExpiredLocks:"pruning"}},pruning:{invoke:{src:({db:e})=>Gr(e),onDone:"idle",onError:"idle"}},done:{type:"final"}},on:{stopLockPruningService:".done"}},operator:{initial:"awaitingCommand",states:{awaitingCommand:{entry:[xe("pruneExpiredLocks"),$("vzfsAwaitingCommand")],on:{close:"close",changeDirectory:"changeDirectory",createFile:"createFile",readFile:"readFile",updateFileTimestamp:"updateFileTimestamp",updateFileContent:"updateFileContent",deleteFile:"deleteFile",createDirectory:"createDirectory",getDirectoryRecord:"getDirectoryRecord",emptyDirectory:"emptyDirectory",deleteDirectoryIfEmpty:"deleteDirectoryIfEmpty",ripFilesystemToJSON:"ripFilesystemToJSON"}},changeDirectory:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{newDirectoryPath:i}=t.data;return new Promise((o,a)=>{(async()=>{try{let c=await U(r,n,i);c.isLeaf&&a("Cannot change directory to a leaf."),o(c.path)}catch(c){a(c)}})()})},onDone:{target:"awaitingCommand",actions:[ae((e,t)=>({...e,cwd:t.data})),$({type:"changeDirectorySuccess",cwd:e=>e.cwd})]},onError:{target:"awaitingCommand",actions:[$((e,t)=>({type:"changeDirectoryFailure",msg:t.data}))]}}},createFile:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{name:i,parentPath:o,content:a}=t.data;return new Promise((c,s)=>{(async()=>{let u,l;try{l=await U(r,n,o),u=await ot(r,n,l.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[u])}catch(d){s(d)}try{let d=await Mr(r,n,i,l.path,a);c(d)}catch(d){s(d)}finally{try{await at(r,u)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[xe("pruneExpiredLocks"),$((e,t)=>({type:"createFileSuccess",newFilePath:t.data.leafPath}))]},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"createFileFailure",msg:t.data}))}}},readFile:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);if(c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),s.isLeaf){let u=await jr(r,s);o(u)}else a(`Cannot read a directory. Path: ${s.path}`)}catch(s){a(s)}finally{try{c&&await at(r,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"readFileSuccess",file:t.data}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"readFileFailure",msg:t.data}))}}},updateFileTimestamp:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),o(await Ge(r,n,s.path))}catch(s){a(s)}finally{try{await at(r,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[$((e,t)=>({type:"updateFileTimestampSuccess",filesTouched:t.data}))]},onError:{target:"awaitingCommand",actions:[$((e,t)=>({type:"updateFileTimestampFailure",msg:t.data}))]}}},updateFileContent:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i,content:o}=t.data;return new Promise((a,c)=>{(async()=>{let s;try{let u=await U(r,n,i);s=await ot(r,n,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[s]);let l=await Vr(r,n,u.path,o);console.log(`u: ${JSON.stringify(l)}`),a(l)}catch(u){console.log(u),c(u)}finally{try{await at(r,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"updateFileSuccess",filesTouched:t.data}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"updateFileFailure",msg:t.data}))}}},deleteFile:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),o(await Br(r,n,s.path))}catch(s){a(s)}finally{try{await at(r,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"deleteFileSuccess"}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"deleteFileFailure",msg:t.data}))}}},createDirectory:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{name:i,parentPath:o}=t.data;return new Promise((a,c)=>{(async()=>{let s;try{let u=await U(r,n,o);console.log(`e ${JSON.stringify(u)}`),s=await ot(r,n,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[s]),a(await qr(r,n,i,u.path))}catch(u){console.log(u),c(u)}finally{try{await at(r,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[$((e,t)=>({type:"createDirectorySuccess"}))]},onError:{target:"awaitingCommand",actions:[$((e,t)=>({type:"createDirectoryFailure",msg:t.data}))]}}},getDirectoryRecord:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e;if(typeof t.data>"u")return new Promise(o=>o({childKeys:[],cwd:n}));let{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);if(c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),s.isLeaf)a(`Cannot get directory record for leaf entity: ${s.path}`);else{let u=await Lr(r,n,s.path);o({entity:s,childKeys:u})}}catch(s){console.log(s.toString()),a(s)}finally{try{c&&await at(r,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"getDirectoryRecordSuccess",data:t.data}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"getDirectoryRecordFailure",msg:t.data}))}}},emptyDirectory:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),s.isLeaf?a(`Cannot call empty directory for leaf entity: ${s.path}`):(await Kr(r,n,s.path),o())}catch(s){a(s)}finally{try{c&&await at(r,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"emptyDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"emptyDirectoryFailure",msg:t.data}))}}},deleteDirectoryIfEmpty:{invoke:{src:(e,t)=>{let{db:r,cwd:n}=e,{path:i}=t.data;return new Promise((o,a)=>{(async()=>{let c;try{let s=await U(r,n,i);c=await ot(r,n,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await st(r,n,[c]),o(await Ur(r,n,s.path))}catch(s){a(s)}finally{try{await at(r,n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:$((e,t)=>({type:"deleteDirectoryIfEmptySuccess"}))},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"deleteDirectoryIfEmptyFailure",msg:t.data}))}}},ripFilesystemToJSON:{invoke:{src:(e,t)=>Promise.all([new Promise((r,n)=>{let{db:i}=e,a=i.transaction("entity","readonly").objectStore("entity").getAll();a.onsuccess=()=>{r(a.result)},a.onerror=()=>{n("Could not getAll entity records")}}),new Promise((r,n)=>{let{db:i}=e,a=i.transaction("content","readonly").objectStore("content").getAll();a.onsuccess=()=>{r(a.result)},a.onerror=()=>{n("Could not getAll content records")}}),new Promise((r,n)=>{let{db:i}=e,a=i.transaction("lock","readonly").objectStore("lock").getAll();a.onsuccess=()=>{r(a.result)},a.onerror=()=>{n("Could not getAll lock records")}})]),onDone:{target:"awaitingCommand",actions:[se((e,t)=>t),$((e,t)=>({type:"ripFilesystemToJSONSuccess",backup:JSON.stringify({entity:t.data[0],content:t.data[1],lock:t.data[2]})}))]},onError:{target:"awaitingCommand",actions:$((e,t)=>({type:"ripFilesystemToJSONFailure",msg:t.data}))}}},close:{type:"final",entry:[xe("stopLockPruningService"),ae(e=>(e.db.close(),{...e,db:null}))]}}}},onDone:{target:"uninitialized",actions:ae(e=>({...e,fsName:null}))}}}}),Xr=bn;var{assign:ct,log:go}=$t;function xn(){let e=new Date;return`${e.toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric",second:"numeric",hour12:!0,fractionalSecondDigits:3})} ${e.toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"})}`}function y(e,t="INFO"){let r;document.querySelector("#app").append((()=>(r=document.createElement("p"),r.innerText=`${xn()} ${t} ${e}`,r))()),r.scrollIntoView()}function Tn(){be(oe({predictableActionArguments:!0,initial:"cleanupOldTestDBs",context:{oldFS:[]},states:{cleanupOldTestDBs:{initial:"deciding",entry:[ct(()=>({fs:Ke(Xr,"fsActor")})),()=>y("enumerateFilesystems")],states:{deciding:{always:[{target:"enumerateFilesystems",cond:()=>typeof window.indexedDB.databases<"u",actions:()=>y("method exists so listing DBs")},{target:"droppingFilesystems",actions:[()=>y("Skipping filesystem enumeration since indexedDB.databases method is not available in this browser."),ct(t=>({...t,oldFS:[{name:"vzfs_test",version:1}]}))]}]},enumerateFilesystems:{entry:[k("fsActor",{type:"listFilesystems"})],on:{listFilesystemsSuccess:{target:"droppingFilesystems",actions:[ct((t,r)=>({...t,oldFS:r.filesystems})),t=>y(`oldFS slated for deletion: ${JSON.stringify(t.oldFS)}`,"INFO")]},listFilesystemsFailure:{actions:()=>y("listFilesystemsFailure")}}},droppingFilesystems:{initial:"routing",states:{routing:{always:[{target:"droppingFilesystem",cond:t=>t.oldFS.length>0},{target:"done"}]},droppingFilesystem:{entry:[t=>y(`deleting fs called: ${t.oldFS[t.oldFS.length-1].name}`),k("fsActor",t=>({type:"dropFilesystem",fsName:typeof t.oldFS<"u"?t.oldFS[t.oldFS.length-1].name:"vzfs_test"}))],on:{dropFilesystemSuccess:{target:"routing",actions:[ct(t=>({...t,oldFS:t.oldFS.slice(0,-1)})),()=>y("drop fs success.")]},dropFilesystemFailure:{target:"routing",actions:[ct(t=>({...t,oldFS:t.oldFS.slice(0,-1)})),()=>y("drop fs failure.")]}}},done:{type:"final"}},onDone:{target:"fin"}},fin:{type:"final"}},onDone:{target:"mainTests",actions:[()=>y("cleanupOldTestDBs success.")]}},mainTests:{initial:"init",states:{init:{always:[{target:"test",actions:[()=>y("initializing vzfs_test db"),k("fsActor",{type:"init",filesystemName:"vzfs_test",version:1})]}]},test:{initial:"waiting",states:{waiting:{on:{vzfsAwaitingCommand:{target:"testOne",actions:[()=>y("vzfsAwaitingCommand signal received.")]}}},testOne:{entry:[()=>y("getting cwd"),k("fsActor",{type:"getDirectoryRecord"})],on:{getDirectoryRecordSuccess:{target:"testTwo",actions:[(t,r)=>y(`cwd: ${r.data.cwd} - count children: ${r.data.childKeys.length}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`cwd fail: ${r.msg}`,"ERROR")]}}},testTwo:{entry:[()=>y("creating file."),k("fsActor",{type:"createFile",data:{name:"test.txt",content:"test content",parentPath:"."}})],on:{createFileSuccess:{target:"testThree",actions:[(t,r)=>y(`created file: ${JSON.stringify(r)}`),ct((t,r)=>({...t,testTwoFilePath:r.newFilePath}))]},createFileFailure:{actions:[(t,r)=>y(`create file fail: ${r.msg}`,"ERROR")]}}},testThree:{entry:[t=>y(`reading file: ${t.testTwoFilePath}`),k("fsActor",t=>({type:"readFile",data:{path:t.testTwoFilePath}}))],on:{readFileSuccess:{target:"testFour",actions:[(t,r)=>y(`read file: ${JSON.stringify(r)}`)]},readFileFailure:{actions:[(t,r)=>y(`read file fail: ${r.msg}`,"ERROR")]}}},testFour:{entry:[t=>y(`renaming file: ${t.testTwoFilePath}`),k("fsActor",t=>({type:"updateFileTimestamp",data:{path:t.testTwoFilePath}}))],on:{updateFileTimestampSuccess:{target:"testFive",actions:[()=>y("touched file.")]},updateFileTimestampFailure:{actions:[(t,r)=>y(`touch file fail: ${r.msg}`,"ERROR")]}}},testFive:{entry:[t=>y("reading file."),k("fsActor",t=>({type:"readFile",data:{path:t.testTwoFilePath}}))],on:{readFileSuccess:{target:"testSix",actions:[(t,r)=>y(`read file: ${JSON.stringify(r)}`)]},readFileFailure:{target:"testSix",actions:[(t,r)=>y(`read file fail: ${r.msg}`,"ERROR")]}}},testSix:{entry:[()=>y("updating file content"),k("fsActor",t=>({type:"updateFileContent",data:{path:t.testTwoFilePath,content:"hello warld"}}))],on:{updateFileSuccess:{target:"testSeven",actions:[(t,r)=>y("updated file content")]},updateFileFailure:{actions:[(t,r)=>y(`update file content fail: ${r.msg}`,"ERROR")]}}},testSeven:{entry:[()=>y("reading file."),k("fsActor",t=>({type:"readFile",data:{path:t.testTwoFilePath}}))],on:{readFileSuccess:{target:"testEight",actions:[(t,r)=>y(`read file: ${JSON.stringify(r)}`)]},readFileFailure:{actions:[(t,r)=>y(`read file fail: ${r.msg}`,"ERROR")]}}},testEight:{entry:[()=>y("deleting file"),k("fsActor",t=>({type:"deleteFile",data:{path:t.testTwoFilePath}}))],on:{deleteFileSuccess:{target:"testNine",actions:[(t,r)=>y(`deleted file: ${JSON.stringify(r)}`)]},deleteFileFailure:{actions:[(t,r)=>y(`delete file fail: ${r.msg}`,"ERROR")]}}},testNine:{entry:[()=>y("create directory"),k("fsActor",()=>({type:"createDirectory",data:{name:"testDir",parentPath:"/"}}))],on:{createDirectorySuccess:{target:"testTen",actions:[(t,r)=>y(`created directory: ${JSON.stringify(r)}`)]},createDirectoryFailure:{actions:[(t,r)=>y(`create directory fail: ${r.msg}`,"ERROR")]}}},testTen:{entry:[()=>y("getting dir record"),k("fsActor",()=>({type:"getDirectoryRecord",data:{path:"/"}}))],on:{getDirectoryRecordSuccess:{target:"test11",actions:[(t,r)=>y(`got directory record: ${JSON.stringify(r)}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`get directory record fail: ${JSON.stringify(r)}`,"ERROR")]}}},test11:{entry:[()=>y("create directory"),k("fsActor",()=>({type:"createDirectory",data:{name:"testDir",parentPath:"/testDir/"}}))],on:{createDirectorySuccess:{target:"test12",actions:[(t,r)=>y(`created directory: ${JSON.stringify(r)}`)]},createDirectoryFailure:{actions:[(t,r)=>y(`create directory fail: ${r.msg}`,"ERROR")]}}},test12:{entry:[()=>y("creating file."),k("fsActor",{type:"createFile",data:{name:"test.txt",content:"test content",parentPath:"/"}})],on:{createFileSuccess:{target:"test13",actions:[(t,r)=>y(`created file: ${JSON.stringify(r)}`),ct((t,r)=>({...t,testTwoFilePath:r.newFilePath}))]},createFileFailure:{actions:[(t,r)=>y(`create file fail: ${r.msg}`,"ERROR")]}}},test13:{entry:[()=>y("getting dir record"),k("fsActor",()=>({type:"getDirectoryRecord",data:{path:"/"}}))],on:{getDirectoryRecordSuccess:{target:"test14",actions:[(t,r)=>y(`got directory record: ${JSON.stringify(r)}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`get directory record fail: ${JSON.stringify(r)}`,"ERROR")]}}},test14:{entry:[()=>y("changing dir"),k("fsActor",{type:"changeDirectory",data:{newDirectoryPath:"/testDir/"}})],on:{changeDirectorySuccess:{target:"test14_5",actions:[(t,r)=>y(`changed directory: ${JSON.stringify(r)}`)]},changeDirectoryFailure:{actions:[(t,r)=>y(`change directory fail: ${JSON.stringify(r)}`)]}}},test14_5:{entry:[()=>y("changing dir"),k("fsActor",{type:"changeDirectory",data:{newDirectoryPath:"/"}})],on:{changeDirectorySuccess:{target:"test15",actions:[(t,r)=>y(`changed directory: ${JSON.stringify(r)}`)]},changeDirectoryFailure:{actions:[(t,r)=>y(`change directory fail: ${JSON.stringify(r)}`)]}}},test15:{entry:[()=>y("creating file."),k("fsActor",{type:"createFile",data:{name:"test2.txt",content:"test content, zing zing zing",parentPath:"/testDir/"}})],on:{createFileSuccess:{target:"test16",actions:[(t,r)=>y(`created file: ${JSON.stringify(r)}`),ct((t,r)=>({...t,testThreeFilePath:r.newFilePath}))]},createFileFailure:{actions:[(t,r)=>y(`create file fail: ${r.msg}`,"ERROR")]}}},test16:{entry:[()=>y("getting dir record"),k("fsActor",()=>({type:"getDirectoryRecord",data:{path:"/testDir/"}}))],on:{getDirectoryRecordSuccess:{target:"test16_5",actions:[(t,r)=>y(`got directory record: ${JSON.stringify(r)}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`get directory record fail: ${JSON.stringify(r)}`,"ERROR")]}}},test16_5:{entry:[()=>y("ripping fs to json"),k("fsActor",{type:"ripFilesystemToJSON"})],on:{ripFilesystemToJSONSuccess:{target:"test17",actions:[(t,r)=>y(`got fs json: ${r.backup}`),ct((t,r)=>({...t,backupForRestoreTest:r.backup}))]},ripFilesystemToJSONFailure:{actions:[(t,r)=>y(`rip fs to json fail: ${JSON.stringify(r)}`)]}}},test17:{entry:[()=>y("emptying /testDir/"),k("fsActor",()=>({type:"emptyDirectory",data:{path:"/testDir/"}}))],on:{emptyDirectorySuccess:{target:"test18",actions:[(t,r)=>y(`emptyed directory: ${JSON.stringify(r)}`)]},emptyDirectoryFailure:{actions:[(t,r)=>y(`empty directory fail: ${JSON.stringify(r)}`)]}}},test18:{entry:[()=>y("getting dir record"),k("fsActor",()=>({type:"getDirectoryRecord",data:{path:"/testDir/"}}))],on:{getDirectoryRecordSuccess:{target:"test19",actions:[(t,r)=>y(`got directory record: ${JSON.stringify(r)}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`get directory record fail: ${JSON.stringify(r)}`,"ERROR")]}}},test19:{entry:[()=>y("deleting /testDir/"),k("fsActor",()=>({type:"deleteDirectoryIfEmpty",data:{path:"/testDir/"}}))],on:{deleteDirectoryIfEmptySuccess:{target:"test20",actions:[(t,r)=>y(`deleted directory: ${JSON.stringify(r)}`)]},deleteDirectoryIfEmptyFailure:{actions:[(t,r)=>y(`delete directory fail: ${JSON.stringify(r)}`)]}}},test20:{entry:[()=>y("getting dir record"),k("fsActor",()=>({type:"getDirectoryRecord",data:{path:"/"}}))],on:{getDirectoryRecordSuccess:{target:"test21",actions:[(t,r)=>y(`got directory record: ${JSON.stringify(r)}`)]},getDirectoryRecordFailure:{actions:[(t,r)=>y(`get directory record fail: ${JSON.stringify(r)}`,"ERROR")]}}},test21:{entry:[k("fsActor",{type:"close"}),()=>y("restoring fs from backup"),k("fsActor",t=>({type:"restoreFilesystemFromJSON",fsName:"restoredFs",version:1,backup:t.backupForRestoreTest}))],on:{restoreFilesystemFromJSONSuccess:{target:"test22",actions:[()=>y("restored filesystem from backup")]},restoreFilesystemFromJSONFailure:{actions:[(t,r)=>y(`restore filesystem from backup fail: ${JSON.stringify(r)}`,"ERROR")]}}},test22:{entry:[()=>y("re-initializing fs"),k("fsActor",{type:"init",filesystemName:"restoredFs",version:1})],on:{vzfsAwaitingCommand:{target:"test23",actions:[(t,r)=>y("vzfs awaiting command")]}}},test23:{entry:[()=>y("ripping fs to json"),k("fsActor",{type:"ripFilesystemToJSON"})],on:{ripFilesystemToJSONSuccess:{actions:[(t,r)=>y(`got fs json: ${r.backup}`),ct((t,r)=>({...t,backupForRestoreTest:r.backup}))]},ripFilesystemToJSONFailure:{actions:[(t,r)=>y(`rip fs to json fail: ${JSON.stringify(r)}`)]}}}}}}}}})).start()}var Yr=Tn;document.addEventListener("DOMContentLoaded",()=>{We(),Yr()});})();
/*! Bundled license information:

xstate/es/_virtual/_tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
