(()=>{var Yn=Object.defineProperty;var Qe=(e,t)=>{for(var n in t)Yn(e,n,{get:t[n],enumerable:!0})};function W(e,t){if(!/^[a-zA-Z0-9_/.-]*$/.test(e))throw"Invalid character(s) in path.";if(e==="/..")throw"Invalid path";if(e==="/."&&(e="/"),/\/\.\.$/.test(e)&&(e=`${e}/`),e=e.split("/").reduce((n,r)=>((n.length===0||r!==n[n.length-1])&&n.push(r),n),[]).filter((n,r,i)=>!(r>0&&r<i.length-1&&n==="")),e.length===1)return`/${e.reduce((n,r)=>r==="."?n:r===".."?n.slice(0,-1):[...n,r],[]).join("/")}`;if(e[0]===""){let n=`${e.reduce((r,i)=>i==="."?r:i===".."?r.slice(0,-1):[...r,i],[]).join("/")}`;if(n==="")throw"Invalid path";return n}else{let r=`${[...t,...e].reduce((i,a)=>a==="."?i:a===".."?i.slice(0,-1):[...i,a],[]).join("/")}`;if(r==="")throw"Invalid path";return r}}function rt(e){return e.split("/").reduce((t,n)=>((t.length===0||n!==t[t.length-1])&&t.push(n),t),[]).filter((t,n,r)=>!(n>0&&n<r.length-1&&t===""))}var Wn=["/home/user/file.js","/absolute/path/to/file.js","relative/path/to/file.js","../relative/path/to/file.js","./relative/path/to/file.js","/root/directory/../file.js","file.js","../../../file.js","/home/user/../file.js","../file.js","./file.js","/root/directory/./file.js","","/","../","./",".../","/..","/.","/../","../../../","/../../..","../../../..","/../../../../",".","..","//","////",".//file.js","..//file.js","directory/","directory/..","../directory/","./directory/"];function Qn(){let e=["","abc","123"];Wn.forEach(t=>{try{console.log(`original: ${t}`),console.log(`normalized: ${W(t,e)}`),console.log(`pieces: ${JSON.stringify(rt(W(t,e)))}`),console.log(`renormalized: ${W(rt(W(t,e)).join("/"),e)}`),console.log("--------")}catch(n){console.log(n)}})}var He=Qn;var pe={};Qe(pe,{actionTypes:()=>xe,after:()=>ke,assign:()=>bn,cancel:()=>Ce,choose:()=>In,done:()=>_t,doneInvoke:()=>lt,error:()=>ht,escalate:()=>ar,forwardTo:()=>xn,getActionFunction:()=>Yt,initEvent:()=>ot,isActionObject:()=>ir,log:()=>mn,pure:()=>Sn,raise:()=>le,resolveActions:()=>bt,resolveLog:()=>gn,resolveRaise:()=>hn,resolveSend:()=>pn,resolveStop:()=>wn,respond:()=>nr,send:()=>ut,sendParent:()=>Qt,sendTo:()=>yn,sendUpdate:()=>vn,start:()=>Ae,stop:()=>he,toActionObject:()=>St,toActionObjects:()=>nt,toActivityDefinition:()=>Wt});var p=function(){return p=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},p.apply(this,arguments)};function It(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function I(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function T(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,a=[],o;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)a.push(i.value)}catch(c){o={error:c}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return a}function _(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,a;r<i;r++)(a||!(r in t))&&(a||(a=Array.prototype.slice.call(t,0,r)),a[r]=t[r]);return e.concat(a||Array.prototype.slice.call(t))}var k;(function(e){e.Start="xstate.start",e.Stop="xstate.stop",e.Raise="xstate.raise",e.Send="xstate.send",e.Cancel="xstate.cancel",e.NullEvent="",e.Assign="xstate.assign",e.After="xstate.after",e.DoneState="done.state",e.DoneInvoke="done.invoke",e.Log="xstate.log",e.Init="xstate.init",e.Invoke="xstate.invoke",e.ErrorExecution="error.execution",e.ErrorCommunication="error.communication",e.ErrorPlatform="error.platform",e.ErrorCustom="xstate.error",e.Update="xstate.update",e.Pure="xstate.pure",e.Choose="xstate.choose"})(k||(k={}));var et;(function(e){e.Parent="#_parent",e.Internal="#_internal"})(et||(et={}));var xe={};Qe(xe,{after:()=>Hn,assign:()=>Ut,cancel:()=>qt,choose:()=>be,doneState:()=>Zn,error:()=>zt,errorExecution:()=>tr,errorPlatform:()=>re,init:()=>we,invoke:()=>Pt,log:()=>Tt,nullEvent:()=>ge,pure:()=>Se,raise:()=>st,send:()=>ft,start:()=>Et,stop:()=>vt,update:()=>mt});var Et=k.Start,vt=k.Stop,st=k.Raise,ft=k.Send,qt=k.Cancel,ge=k.NullEvent,Ut=k.Assign,Hn=k.After,Zn=k.DoneState,Tt=k.Log,we=k.Init,Pt=k.Invoke,tr=k.ErrorExecution,re=k.ErrorPlatform,zt=k.ErrorCustom,mt=k.Update,be=k.Choose,Se=k.Pure;var ie=".",Ie={},ae="xstate.guard",Ze="";var L=!0;var oe;function Jt(e,t,n){n===void 0&&(n=ie);var r=Ct(e,n),i=Ct(t,n);return P(i)?P(r)?i===r:!1:P(r)?r in i:Object.keys(r).every(function(a){return a in i?Jt(r[a],i[a]):!1})}function se(e){try{return P(e)||typeof e=="number"?"".concat(e):e.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function ce(e,t){try{return ct(e)?e:e.toString().split(t)}catch{throw new Error("'".concat(e,"' is not a valid state path."))}}function er(e){return typeof e=="object"&&"value"in e&&"context"in e&&"event"in e&&"_event"in e}function Ct(e,t){if(er(e))return e.value;if(ct(e))return Kt(e);if(typeof e!="string")return e;var n=ce(e,t);return Kt(n)}function Kt(e){if(e.length===1)return e[0];for(var t={},n=t,r=0;r<e.length-1;r++)r===e.length-2?n[e[r]]=e[r+1]:(n[e[r]]={},n=n[e[r]]);return t}function At(e,t){for(var n={},r=Object.keys(e),i=0;i<r.length;i++){var a=r[i];n[a]=t(e[a],a,e,i)}return n}function Ee(e,t,n){var r,i,a={};try{for(var o=I(Object.keys(e)),c=o.next();!c.done;c=o.next()){var s=c.value,u=e[s];n(u)&&(a[s]=t(u,s,e))}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}var tn=function(e){return function(t){var n,r,i=t;try{for(var a=I(e),o=a.next();!o.done;o=a.next()){var c=o.value;i=i[c]}}catch(s){n={error:s}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return i}};function en(e,t){return function(n){var r,i,a=n;try{for(var o=I(e),c=o.next();!c.done;c=o.next()){var s=c.value;a=a[t][s]}}catch(u){r={error:u}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}}function Gt(e){if(!e)return[[]];if(P(e))return[[e]];var t=j(Object.keys(e).map(function(n){var r=e[n];return typeof r!="string"&&(!r||!Object.keys(r).length)?[[n]]:Gt(e[n]).map(function(i){return[n].concat(i)})}));return t}function j(e){var t;return(t=[]).concat.apply(t,_([],T(e),!1))}function nn(e){return ct(e)?e:[e]}function Y(e){return e===void 0?[]:nn(e)}function gt(e,t,n){var r,i;if(C(e))return e(t,n.data);var a={};try{for(var o=I(Object.keys(e)),c=o.next();!c.done;c=o.next()){var s=c.value,u=e[s];C(u)?a[s]=u(t,n.data):a[s]=u}}catch(d){r={error:d}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}function rn(e){return/^(done|error)\./.test(e)}function Te(e){return!!(e instanceof Promise||e!==null&&(C(e)||typeof e=="object")&&C(e.then))}function an(e){return e!==null&&typeof e=="object"&&"transition"in e&&typeof e.transition=="function"}function on(e,t){var n,r,i=T([[],[]],2),a=i[0],o=i[1];try{for(var c=I(e),s=c.next();!s.done;s=c.next()){var u=s.value;t(u)?a.push(u):o.push(u)}}catch(d){n={error:d}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return[a,o]}function sn(e,t){return At(e.states,function(n,r){if(n){var i=(P(t)?void 0:t[r])||(n?n.current:void 0);if(i)return{current:i,states:sn(n,i)}}})}function cn(e,t){return{current:t,states:sn(e,t)}}function Pe(e,t,n,r){L||U(!!e,"Attempting to update undefined context");var i=e&&n.reduce(function(a,o){var c,s,u=o.assignment,d={state:r,action:o,_event:t},l={};if(C(u))l=u(a,t.data,d);else try{for(var f=I(Object.keys(u)),h=f.next();!h.done;h=f.next()){var y=h.value,v=u[y];l[y]=C(v)?v(a,t.data,d):v}}catch(b){c={error:b}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(c)throw c.error}}return Object.assign({},a,l)},e);return i}var U=function(){};L||(U=function(e,t){var n=e instanceof Error?e:void 0;if(!(!n&&e)&&console!==void 0){var r=["Warning: ".concat(t)];n&&r.push(n),console.warn.apply(console,r)}});function ct(e){return Array.isArray(e)}function C(e){return typeof e=="function"}function P(e){return typeof e=="string"}function ue(e,t){if(e)return P(e)?{type:ae,name:e,predicate:t?t[e]:void 0}:C(e)?{type:ae,name:e.name,predicate:e}:e}function un(e){try{return"subscribe"in e&&C(e.subscribe)}catch{return!1}}var it=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),Fr=(oe={},oe[it]=function(){return this},oe[Symbol.observable]=function(){return this},oe);function at(e){return!!e&&"__xstatenode"in e}function dn(e){return!!e&&typeof e.send=="function"}function kt(e,t){return P(e)||typeof e=="number"?p({type:e},t):e}function K(e,t){if(!P(e)&&"$$type"in e&&e.$$type==="scxml")return e;var n=kt(e);return p({name:n.type,data:n,$$type:"scxml",type:"external"},t)}function wt(e,t){var n=nn(t).map(function(r){return typeof r>"u"||typeof r=="string"||at(r)?{target:r,event:e}:p(p({},r),{event:e})});return n}function fn(e){if(!(e===void 0||e===Ze))return Y(e)}function ln(e,t,n){if(!L){var r=e.stack?" Stacktrace was '".concat(e.stack,"'"):"";if(e===t)console.error("Missing onError handler for invocation '".concat(n,"', error was '").concat(e,"'.").concat(r));else{var i=t.stack?" Stacktrace was '".concat(t.stack,"'"):"";console.error("Missing onError handler and/or unhandled exception/promise rejection for invocation '".concat(n,"'. ")+"Original error: '".concat(e,"'. ").concat(r," Current error is '").concat(t,"'.").concat(i))}}}function de(e,t,n,r,i){var a=e.options.guards,o={state:i,cond:t,_event:r};if(t.type===ae)return(a?.[t.name]||t.predicate)(n,r.data,o);var c=a?.[t.type];if(!c)throw new Error("Guard '".concat(t.type,"' is not implemented on machine '").concat(e.id,"'."));return c(n,r.data,o)}function fe(e){return typeof e=="string"?{type:e}:e}function Dt(e,t,n){var r=function(){},i=typeof e=="object",a=i?e:null;return{next:((i?e.next:e)||r).bind(a),error:((i?e.error:t)||r).bind(a),complete:((i?e.complete:n)||r).bind(a)}}function Vt(e,t){return"".concat(e,":invocation[").concat(t,"]")}function Xt(e){return(e.type===st||e.type===ft&&e.to===et.Internal)&&typeof e.delay!="number"}var ot=K({type:we});function Yt(e,t){return t&&t[e]||void 0}function St(e,t){var n;if(P(e)||typeof e=="number"){var r=Yt(e,t);C(r)?n={type:e,exec:r}:r?n=r:n={type:e,exec:void 0}}else if(C(e))n={type:e.name||e.toString(),exec:e};else{var r=Yt(e.type,t);if(C(r))n=p(p({},e),{exec:r});else if(r){var i=r.type||e.type;n=p(p(p({},r),e),{type:i})}else n=e}return n}var nt=function(e,t){if(!e)return[];var n=ct(e)?e:[e];return n.map(function(r){return St(r,t)})};function Wt(e){var t=St(e);return p(p({id:P(e)?e:t.id},t),{type:t.type})}function le(e,t){return{type:st,event:typeof e=="function"?e:kt(e),delay:t?t.delay:void 0,id:t?.id}}function hn(e,t,n,r){var i={_event:n},a=K(C(e.event)?e.event(t,n.data,i):e.event),o;if(P(e.delay)){var c=r&&r[e.delay];o=C(c)?c(t,n.data,i):c}else o=C(e.delay)?e.delay(t,n.data,i):e.delay;return p(p({},e),{type:st,_event:a,delay:o})}function ut(e,t){return{to:t?t.to:void 0,type:ft,event:C(e)?e:kt(e),delay:t?t.delay:void 0,id:t&&t.id!==void 0?t.id:C(e)?e.name:se(e)}}function pn(e,t,n,r){var i={_event:n},a=K(C(e.event)?e.event(t,n.data,i):e.event),o;if(P(e.delay)){var c=r&&r[e.delay];o=C(c)?c(t,n.data,i):c}else o=C(e.delay)?e.delay(t,n.data,i):e.delay;var s=C(e.to)?e.to(t,n.data,i):e.to;return p(p({},e),{to:s,_event:a,event:a.data,delay:o})}function Qt(e,t){return ut(e,p(p({},t),{to:et.Parent}))}function yn(e,t,n){return ut(t,p(p({},n),{to:e}))}function vn(){return Qt(mt)}function nr(e,t){return ut(e,p(p({},t),{to:function(n,r,i){var a=i._event;return a.origin}}))}var rr=function(e,t){return{context:e,event:t}};function mn(e,t){return e===void 0&&(e=rr),{type:Tt,label:t,expr:e}}var gn=function(e,t,n){return p(p({},e),{value:P(e.expr)?e.expr:e.expr(t,n.data,{_event:n})})},Ce=function(e){return{type:qt,sendId:e}};function Ae(e){var t=Wt(e);return{type:k.Start,activity:t,exec:void 0}}function he(e){var t=C(e)?e:Wt(e);return{type:k.Stop,activity:t,exec:void 0}}function wn(e,t,n){var r=C(e.activity)?e.activity(t,n.data):e.activity,i=typeof r=="string"?{id:r}:r,a={type:k.Stop,activity:i};return a}var bn=function(e){return{type:Ut,assignment:e}};function ir(e){return typeof e=="object"&&"type"in e}function ke(e,t){var n=t?"#".concat(t):"";return"".concat(k.After,"(").concat(e,")").concat(n)}function _t(e,t){var n="".concat(k.DoneState,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}function lt(e,t){var n="".concat(k.DoneInvoke,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}function ht(e,t){var n="".concat(k.ErrorPlatform,".").concat(e),r={type:n,data:t};return r.toString=function(){return n},r}function Sn(e){return{type:k.Pure,get:e}}function xn(e,t){if(!L&&(!e||typeof e=="function")){var n=e;e=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=typeof n=="function"?n.apply(void 0,_([],T(r),!1)):n;if(!a)throw new Error("Attempted to forward event to undefined actor. This risks an infinite loop in the sender.");return a}}return ut(function(r,i){return i},p(p({},t),{to:e}))}function ar(e,t){return Qt(function(n,r,i){return{type:zt,data:C(e)?e(n,r,i):e}},p(p({},t),{to:et.Parent}))}function In(e){return{type:k.Choose,conds:e}}var or=function(e){var t,n,r=[];try{for(var i=I(e),a=i.next();!a.done;a=i.next())for(var o=a.value,c=0;c<o.actions.length;){if(o.actions[c].type===Ut){r.push(o.actions[c]),o.actions.splice(c,1);continue}c++}}catch(s){t={error:s}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r};function bt(e,t,n,r,i,a,o){o===void 0&&(o=!1);var c=o?[]:or(i),s=c.length?Pe(n,r,c,t):n,u=o?[n]:void 0,d=[];function l(y,v){var b;switch(v.type){case st:{var g=hn(v,s,r,e.options.delays);return a&&typeof g.delay=="number"&&a(g,s,r),g}case ft:var m=pn(v,s,r,e.options.delays);if(!L){var w=v.delay;U(!P(w)||typeof m.delay=="number","No delay reference for delay expression '".concat(w,"' was found on machine '").concat(e.id,"'"))}return a&&m.to!==et.Internal&&(y==="entry"?d.push(m):a(m,s,r)),m;case Tt:{var x=gn(v,s,r);return a?.(x,s,r),x}case be:{var N=v,O=(b=N.conds.find(function(yt){var dt=ue(yt.cond,e.options.guards);return!dt||de(e,dt,s,r,a?void 0:t)}))===null||b===void 0?void 0:b.actions;if(!O)return[];var D=T(bt(e,t,s,r,[{type:y,actions:nt(Y(O),e.options.actions)}],a,o),2),M=D[0],A=D[1];return s=A,u?.push(s),M}case Se:{var O=v.get(s,r.data);if(!O)return[];var z=T(bt(e,t,s,r,[{type:y,actions:nt(Y(O),e.options.actions)}],a,o),2),E=z[0],$=z[1];return s=$,u?.push(s),E}case vt:{var x=wn(v,s,r);return a?.(x,n,r),x}case Ut:{s=Pe(s,r,[v],a?void 0:t),u?.push(s);break}default:var G=St(v,e.options.actions),X=G.exec;if(a)a(G,s,r);else if(X&&u){var Bt=u.length-1,me=p(p({},G),{exec:function(yt){for(var dt=[],H=1;H<arguments.length;H++)dt[H-1]=arguments[H];X.apply(void 0,_([u[Bt]],T(dt),!1))}});G=me}return G}}function f(y){var v,b,g=[];try{for(var m=I(y.actions),w=m.next();!w.done;w=m.next()){var x=w.value,N=l(y.type,x);N&&(g=g.concat(N))}}catch(O){v={error:O}}finally{try{w&&!w.done&&(b=m.return)&&b.call(m)}finally{if(v)throw v.error}}return d.forEach(function(O){a(O,s,r)}),d.length=0,g}var h=j(i.map(f));return[h,s]}var En=[],pt=function(e,t){En.push(e);var n=t(e);return En.pop(),n};function Tn(e){var t;return t={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:e}}},t[it]=function(){return this},t}function Pn(e,t,n,r){var i,a=fe(e.src),o=(i=t?.options.services)===null||i===void 0?void 0:i[a.type],c=e.data?gt(e.data,n,r):void 0,s=o?De(o,e.id,c):Tn(e.id);return s.meta=e,s}function De(e,t,n){var r=Tn(t);if(r.deferred=!0,at(e)){var i=r.state=pt(void 0,function(){return(n?e.withContext(n):e).initialState});r.getSnapshot=function(){return i}}return r}function sr(e){try{return typeof e.send=="function"}catch{return!1}}function Cn(e){return sr(e)&&"id"in e}function An(e){var t;return p((t={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},t[it]=function(){return this},t),e)}var Ht=function(e){return e.type==="atomic"||e.type==="final"};function Oe(e){return Object.keys(e.states).map(function(t){return e.states[t]})}function Ot(e){return Oe(e).filter(function(t){return t.type!=="history"})}function Le(e){var t=[e];return Ht(e)?t:t.concat(j(Ot(e).map(Le)))}function Lt(e,t){var n,r,i,a,o,c,s,u,d=new Set(e),l=_e(d),f=new Set(t);try{for(var h=I(f),y=h.next();!y.done;y=h.next())for(var v=y.value,b=v.parent;b&&!f.has(b);)f.add(b),b=b.parent}catch(A){n={error:A}}finally{try{y&&!y.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}var g=_e(f);try{for(var m=I(f),w=m.next();!w.done;w=m.next()){var v=w.value;if(v.type==="compound"&&(!g.get(v)||!g.get(v).length))l.get(v)?l.get(v).forEach(function(z){return f.add(z)}):v.initialStateNodes.forEach(function(z){return f.add(z)});else if(v.type==="parallel")try{for(var x=(o=void 0,I(Ot(v))),N=x.next();!N.done;N=x.next()){var O=N.value;f.has(O)||(f.add(O),l.get(O)?l.get(O).forEach(function(z){return f.add(z)}):O.initialStateNodes.forEach(function(z){return f.add(z)}))}}catch(z){o={error:z}}finally{try{N&&!N.done&&(c=x.return)&&c.call(x)}finally{if(o)throw o.error}}}}catch(A){i={error:A}}finally{try{w&&!w.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}try{for(var D=I(f),M=D.next();!M.done;M=D.next())for(var v=M.value,b=v.parent;b&&!f.has(b);)f.add(b),b=b.parent}catch(A){s={error:A}}finally{try{M&&!M.done&&(u=D.return)&&u.call(D)}finally{if(s)throw s.error}}return f}function kn(e,t){var n=t.get(e);if(!n)return{};if(e.type==="compound"){var r=n[0];if(r){if(Ht(r))return r.key}else return{}}var i={};return n.forEach(function(a){i[a.key]=kn(a,t)}),i}function _e(e){var t,n,r=new Map;try{for(var i=I(e),a=i.next();!a.done;a=i.next()){var o=a.value;r.has(o)||r.set(o,[]),o.parent&&(r.has(o.parent)||r.set(o.parent,[]),r.get(o.parent).push(o))}}catch(c){t={error:c}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Dn(e,t){var n=Lt([e],t);return kn(e,_e(n))}function Ft(e,t){return Array.isArray(e)?e.some(function(n){return n===t}):e instanceof Set?e.has(t):!1}function _n(e){return _([],T(new Set(j(_([],T(e.map(function(t){return t.ownEvents})),!1)))),!1)}function Zt(e,t){return t.type==="compound"?Ot(t).some(function(n){return n.type==="final"&&Ft(e,n)}):t.type==="parallel"?Ot(t).every(function(n){return Zt(e,n)}):!1}function On(e){return e===void 0&&(e=[]),e.reduce(function(t,n){return n.meta!==void 0&&(t[n.id]=n.meta),t},{})}function Fe(e){return new Set(j(e.map(function(t){return t.tags})))}function Me(e,t){if(e===t)return!0;if(e===void 0||t===void 0)return!1;if(P(e)||P(t))return e===t;var n=Object.keys(e),r=Object.keys(t);return n.length===r.length&&n.every(function(i){return Me(e[i],t[i])})}function Ln(e){return typeof e!="object"||e===null?!1:"value"in e&&"_event"in e}function Fn(e,t){var n=e.exec,r=p(p({},e),{exec:n!==void 0?function(){return n(t.context,t.event,{action:e,state:t,_event:t._event})}:void 0});return r}var Q=function(){function e(t){var n=this,r;this.actions=[],this.activities=Ie,this.meta={},this.events=[],this.value=t.value,this.context=t.context,this._event=t._event,this._sessionid=t._sessionid,this.event=this._event.data,this.historyValue=t.historyValue,this.history=t.history,this.actions=t.actions||[],this.activities=t.activities||Ie,this.meta=On(t.configuration),this.events=t.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=t.configuration,this.transitions=t.transitions,this.children=t.children,this.done=!!t.done,this.tags=(r=Array.isArray(t.tags)?new Set(t.tags):t.tags)!==null&&r!==void 0?r:new Set,this.machine=t.machine,Object.defineProperty(this,"nextEvents",{get:function(){return _n(n.configuration)}})}return e.from=function(t,n){if(t instanceof e)return t.context!==n?new e({value:t.value,context:n,_event:t._event,_sessionid:null,historyValue:t.historyValue,history:t.history,actions:[],activities:t.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):t;var r=ot;return new e({value:t,context:n,_event:r,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},e.create=function(t){return new e(t)},e.inert=function(t,n){if(t instanceof e){if(!t.actions.length)return t;var r=ot;return new e({value:t.value,context:n,_event:r,_sessionid:null,historyValue:t.historyValue,history:t.history,activities:t.activities,configuration:t.configuration,transitions:[],children:{}})}return e.from(t,n)},e.prototype.toStrings=function(t,n){var r=this;if(t===void 0&&(t=this.value),n===void 0&&(n="."),P(t))return[t];var i=Object.keys(t);return i.concat.apply(i,_([],T(i.map(function(a){return r.toStrings(t[a],n).map(function(o){return a+n+o})})),!1))},e.prototype.toJSON=function(){var t=this;t.configuration,t.transitions;var n=t.tags;t.machine;var r=It(t,["configuration","transitions","tags","machine"]);return p(p({},r),{tags:Array.from(n)})},e.prototype.matches=function(t){return Jt(t,this.value)},e.prototype.hasTag=function(t){return this.tags.has(t)},e.prototype.can=function(t){var n;L&&U(!!this.machine,"state.can(...) used outside of a machine-created State object; this will always return false.");var r=(n=this.machine)===null||n===void 0?void 0:n.getTransitionData(this,t);return!!r?.transitions.length&&r.transitions.some(function(i){return i.target!==void 0||i.actions.length})},e}();var cr={deferEvents:!1},je=function(){function e(t){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=p(p({},cr),t)}return e.prototype.initialize=function(t){if(this.initialized=!0,t){if(!this.options.deferEvents){this.schedule(t);return}this.process(t)}this.flushEvents()},e.prototype.schedule=function(t){if(!this.initialized||this.processingEvent){this.queue.push(t);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(t),this.flushEvents()},e.prototype.clear=function(){this.queue=[]},e.prototype.flushEvents=function(){for(var t=this.queue.shift();t;)this.process(t),t=this.queue.shift()},e.prototype.process=function(t){this.processingEvent=!0;try{t()}catch(n){throw this.clear(),n}finally{this.processingEvent=!1}},e}();var Ne=new Map,ur=0,Mt={bookId:function(){return"x:".concat(ur++)},register:function(e,t){return Ne.set(e,t),e},get:function(e){return Ne.get(e)},free:function(e){Ne.delete(e)}};function ye(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;L||console.warn("XState could not find a global object in this environment. Please let the maintainers know and raise an issue here: https://github.com/statelyai/xstate/issues")}function dr(){var e=ye();if(e&&"__xstate__"in e)return e.__xstate__}function Mn(e){if(ye()){var t=dr();t&&t.register(e)}}function jn(e,t){t===void 0&&(t={});var n=e.initialState,r=new Set,i=[],a=!1,o=function(){if(!a){for(a=!0;i.length>0;){var u=i.shift();n=e.transition(n,u,s),r.forEach(function(d){return d.next(n)})}a=!1}},c=An({id:t.id,send:function(u){i.push(u),o()},getSnapshot:function(){return n},subscribe:function(u,d,l){var f=Dt(u,d,l);return r.add(f),f.next(n),{unsubscribe:function(){r.delete(f)}}}}),s={parent:t.parent,self:c,id:t.id||"anonymous",observers:r};return n=e.start?e.start(s):n,c}var fr={sync:!1,autoForward:!1},J;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(J||(J={}));var Nn=function(){function e(t,n){n===void 0&&(n=e.defaultOptions);var r=this;this.machine=t,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=J.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(d,l){if(ct(d))return r.batch(d),r.state;var f=K(kt(d,l));if(r.status===J.Stopped)return L||U(!1,'Event "'.concat(f.name,'" was sent to stopped service "').concat(r.machine.id,`". This service has already reached its final state, and will not transition.
Event: `).concat(JSON.stringify(f.data))),r.state;if(r.status!==J.Running&&!r.options.deferEvents)throw new Error('Event "'.concat(f.name,'" was sent to uninitialized service "').concat(r.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(f.data)));return r.scheduler.schedule(function(){r.forward(f);var h=r._nextState(f);r.update(h,f)}),r._state},this.sendTo=function(d,l,f){var h=r.parent&&(l===et.Parent||r.parent.id===l),y=h?r.parent:P(l)?l===et.Internal?r:r.children.get(l)||Mt.get(l):dn(l)?l:void 0;if(!y){if(!h)throw new Error("Unable to send event to child '".concat(l,"' from service '").concat(r.id,"'."));L||U(!1,"Service '".concat(r.id,"' has no parent: unable to send event ").concat(d.type));return}if("machine"in y){if(r.status!==J.Stopped||r.parent!==y||r.state.done){var v=p(p({},d),{name:d.name===zt?"".concat(ht(r.id)):d.name,origin:r.sessionId});!f&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([y,v]):y.send(v)}}else!f&&r.machine.config.predictableActionArguments?r._outgoingQueue.push([y,d.data]):y.send(d.data)},this._exec=function(d,l,f,h){h===void 0&&(h=r.machine.options.actions);var y=d.exec||Yt(d.type,h),v=C(y)?y:y?y.exec:d.exec;if(v)try{return v(l,f.data,r.machine.config.predictableActionArguments?{action:d,_event:f}:{action:d,state:r.state,_event:f})}catch(X){throw r.parent&&r.parent.send({type:"xstate.error",data:X}),X}switch(d.type){case st:{var b=d;r.defer(b);break}case ft:var g=d;if(typeof g.delay=="number"){r.defer(g);return}else g.to?r.sendTo(g._event,g.to,f===ot):r.send(g._event);break;case qt:r.cancel(d.sendId);break;case Et:{if(r.status!==J.Running)return;var m=d.activity;if(!r.machine.config.predictableActionArguments&&!r.state.activities[m.id||m.type])break;if(m.type===k.Invoke){var w=fe(m.src),x=r.machine.options.services?r.machine.options.services[w.type]:void 0,N=m.id,O=m.data;L||U(!("forward"in m),"`forward` property is deprecated (found in invocation of '".concat(m.src,"' in in machine '").concat(r.machine.id,"'). ")+"Please use `autoForward` instead.");var D="autoForward"in m?m.autoForward:!!m.forward;if(!x){L||U(!1,"No service found for invocation '".concat(m.src,"' in machine '").concat(r.machine.id,"'."));return}var M=O?gt(O,l,f):void 0;if(typeof x=="string")return;var A=C(x)?x(l,f.data,{data:M,src:w,meta:m.meta}):x;if(!A)return;var z=void 0;at(A)&&(A=M?A.withContext(M):A,z={autoForward:D}),r.spawn(A,N,z)}else r.spawnActivity(m);break}case vt:{r.stopChild(d.activity.id);break}case Tt:var E=d,$=E.label,G=E.value;$?r.logger($,G):r.logger(G);break;default:L||U(!1,"No implementation found for action type '".concat(d.type,"'"));break}};var i=p(p({},e.defaultOptions),n),a=i.clock,o=i.logger,c=i.parent,s=i.id,u=s!==void 0?s:t.id;this.id=u,this.logger=o,this.clock=a,this.parent=c,this.options=i,this.scheduler=new je({deferEvents:this.options.deferEvents}),this.sessionId=Mt.bookId()}return Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this;return this._initialState?this._initialState:pt(this,function(){return t._initialState=t.machine.initialState,t._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return L||U(this.status!==J.NotStarted,"Attempted to read state from uninitialized service '".concat(this.id,"'. Make sure the service is started first.")),this._state},enumerable:!1,configurable:!0}),e.prototype.execute=function(t,n){var r,i;try{for(var a=I(t.actions),o=a.next();!o.done;o=a.next()){var c=o.value;this.exec(c,t,n)}}catch(s){r={error:s}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}},e.prototype.update=function(t,n){var r,i,a,o,c,s,u,d,l=this;if(t._sessionid=this.sessionId,this._state=t,(!this.machine.config.predictableActionArguments||n===ot)&&this.options.execute)this.execute(this.state);else for(var f=void 0;f=this._outgoingQueue.shift();)f[0].send(f[1]);if(this.children.forEach(function(A){l.state.children[A.id]=A}),this.devTools&&this.devTools.send(n.data,t),t.event)try{for(var h=I(this.eventListeners),y=h.next();!y.done;y=h.next()){var v=y.value;v(t.event)}}catch(A){r={error:A}}finally{try{y&&!y.done&&(i=h.return)&&i.call(h)}finally{if(r)throw r.error}}try{for(var b=I(this.listeners),g=b.next();!g.done;g=b.next()){var v=g.value;v(t,t.event)}}catch(A){a={error:A}}finally{try{g&&!g.done&&(o=b.return)&&o.call(b)}finally{if(a)throw a.error}}try{for(var m=I(this.contextListeners),w=m.next();!w.done;w=m.next()){var x=w.value;x(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(A){c={error:A}}finally{try{w&&!w.done&&(s=m.return)&&s.call(m)}finally{if(c)throw c.error}}if(this.state.done){var N=t.configuration.find(function(A){return A.type==="final"&&A.parent===l.machine}),O=N&&N.doneData?gt(N.doneData,t.context,n):void 0;this._doneEvent=lt(this.id,O);try{for(var D=I(this.doneListeners),M=D.next();!M.done;M=D.next()){var v=M.value;v(this._doneEvent)}}catch(A){u={error:A}}finally{try{M&&!M.done&&(d=D.return)&&d.call(D)}finally{if(u)throw u.error}}this._stop(),this._stopChildren(),Mt.free(this.sessionId)}},e.prototype.onTransition=function(t){return this.listeners.add(t),this.status===J.Running&&t(this.state,this.state.event),this},e.prototype.subscribe=function(t,n,r){var i=this,a=Dt(t,n,r);this.listeners.add(a.next),this.status!==J.NotStarted&&a.next(this.state);var o=function(){i.doneListeners.delete(o),i.stopListeners.delete(o),a.complete()};return this.status===J.Stopped?a.complete():(this.onDone(o),this.onStop(o)),{unsubscribe:function(){i.listeners.delete(a.next),i.doneListeners.delete(o),i.stopListeners.delete(o)}}},e.prototype.onEvent=function(t){return this.eventListeners.add(t),this},e.prototype.onSend=function(t){return this.sendListeners.add(t),this},e.prototype.onChange=function(t){return this.contextListeners.add(t),this},e.prototype.onStop=function(t){return this.stopListeners.add(t),this},e.prototype.onDone=function(t){return this.status===J.Stopped&&this._doneEvent?t(this._doneEvent):this.doneListeners.add(t),this},e.prototype.off=function(t){return this.listeners.delete(t),this.eventListeners.delete(t),this.sendListeners.delete(t),this.stopListeners.delete(t),this.doneListeners.delete(t),this.contextListeners.delete(t),this},e.prototype.start=function(t){var n=this;if(this.status===J.Running)return this;this.machine._init(),Mt.register(this.sessionId,this),this.initialized=!0,this.status=J.Running;var r=t===void 0?this.initialState:pt(this,function(){return Ln(t)?n.machine.resolveState(t):n.machine.resolveState(Q.from(t,n.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){n.update(r,ot)}),this},e.prototype._stopChildren=function(){this.children.forEach(function(t){C(t.stop)&&t.stop()}),this.children.clear()},e.prototype._stop=function(){var t,n,r,i,a,o,c,s,u,d;try{for(var l=I(this.listeners),f=l.next();!f.done;f=l.next()){var h=f.value;this.listeners.delete(h)}}catch(D){t={error:D}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}try{for(var y=I(this.stopListeners),v=y.next();!v.done;v=y.next()){var h=v.value;h(),this.stopListeners.delete(h)}}catch(D){r={error:D}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(r)throw r.error}}try{for(var b=I(this.contextListeners),g=b.next();!g.done;g=b.next()){var h=g.value;this.contextListeners.delete(h)}}catch(D){a={error:D}}finally{try{g&&!g.done&&(o=b.return)&&o.call(b)}finally{if(a)throw a.error}}try{for(var m=I(this.doneListeners),w=m.next();!w.done;w=m.next()){var h=w.value;this.doneListeners.delete(h)}}catch(D){c={error:D}}finally{try{w&&!w.done&&(s=m.return)&&s.call(m)}finally{if(c)throw c.error}}if(!this.initialized)return this;this.initialized=!1,this.status=J.Stopped,this._initialState=void 0;try{for(var x=I(Object.keys(this.delayedEventsMap)),N=x.next();!N.done;N=x.next()){var O=N.value;this.clock.clearTimeout(this.delayedEventsMap[O])}}catch(D){u={error:D}}finally{try{N&&!N.done&&(d=x.return)&&d.call(x)}finally{if(u)throw u.error}}this.scheduler.clear(),this.scheduler=new je({deferEvents:this.options.deferEvents})},e.prototype.stop=function(){var t=this,n=this.scheduler;return this._stop(),n.schedule(function(){var r=K({type:"xstate.stop"}),i=pt(t,function(){var a=j(_([],T(t.state.configuration),!1).sort(function(d,l){return l.order-d.order}).map(function(d){return nt(d.onExit,t.machine.options.actions)})),o=T(bt(t.machine,t.state,t.state.context,r,[{type:"exit",actions:a}],t.machine.config.predictableActionArguments?t._exec:void 0,t.machine.config.predictableActionArguments||t.machine.config.preserveActionOrder),2),c=o[0],s=o[1],u=new Q({value:t.state.value,context:s,_event:r,_sessionid:t.sessionId,historyValue:void 0,history:t.state,actions:c.filter(function(d){return!Xt(d)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:t.state.done,tags:t.state.tags,machine:t.machine});return u.changed=!0,u});t.update(i,r),t._stopChildren(),Mt.free(t.sessionId)}),this},e.prototype.batch=function(t){var n=this;if(this.status===J.NotStarted&&this.options.deferEvents)L||U(!1,"".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,`" and are deferred. Make sure .start() is called for this service.
Event: `).concat(JSON.stringify(event)));else if(this.status!==J.Running)throw new Error("".concat(t.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'));if(t.length){var r=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,a,o=n.state,c=!1,s=[],u=function(h){var y=K(h);n.forward(y),o=pt(n,function(){return n.machine.transition(o,y,void 0,r||void 0)}),s.push.apply(s,_([],T(n.machine.config.predictableActionArguments?o.actions:o.actions.map(function(v){return Fn(v,o)})),!1)),c=c||!!o.changed};try{for(var d=I(t),l=d.next();!l.done;l=d.next()){var f=l.value;u(f)}}catch(h){i={error:h}}finally{try{l&&!l.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}o.changed=c,o.actions=s,n.update(o,K(t[t.length-1]))})}},e.prototype.sender=function(t){return this.send.bind(this,t)},e.prototype._nextState=function(t,n){var r=this;n===void 0&&(n=!!this.machine.config.predictableActionArguments&&this._exec);var i=K(t);if(i.name.indexOf(re)===0&&!this.state.nextEvents.some(function(o){return o.indexOf(re)===0}))throw i.data.data;var a=pt(this,function(){return r.machine.transition(r.state,i,void 0,n||void 0)});return a},e.prototype.nextState=function(t){return this._nextState(t,!1)},e.prototype.forward=function(t){var n,r;try{for(var i=I(this.forwardTo),a=i.next();!a.done;a=i.next()){var o=a.value,c=this.children.get(o);if(!c)throw new Error("Unable to forward event '".concat(t,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(o,"'."));c.send(t)}}catch(s){n={error:s}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}},e.prototype.defer=function(t){var n=this,r=this.clock.setTimeout(function(){"to"in t&&t.to?n.sendTo(t._event,t.to,!0):n.send(t._event)},t.delay);t.id&&(this.delayedEventsMap[t.id]=r)},e.prototype.cancel=function(t){this.clock.clearTimeout(this.delayedEventsMap[t]),delete this.delayedEventsMap[t]},e.prototype.exec=function(t,n,r){r===void 0&&(r=this.machine.options.actions),this._exec(t,n.context,n._event,r)},e.prototype.removeChild=function(t){var n;this.children.delete(t),this.forwardTo.delete(t),(n=this.state)===null||n===void 0||delete n.children[t]},e.prototype.stopChild=function(t){var n=this.children.get(t);n&&(this.removeChild(t),C(n.stop)&&n.stop())},e.prototype.spawn=function(t,n,r){if(this.status!==J.Running)return De(t,n);if(Te(t))return this.spawnPromise(Promise.resolve(t),n);if(C(t))return this.spawnCallback(t,n);if(Cn(t))return this.spawnActor(t,n);if(un(t))return this.spawnObservable(t,n);if(at(t))return this.spawnMachine(t,p(p({},r),{id:n}));if(an(t))return this.spawnBehavior(t,n);throw new Error('Unable to spawn entity "'.concat(n,'" of type "').concat(typeof t,'".'))},e.prototype.spawnMachine=function(t,n){var r=this;n===void 0&&(n={});var i=new e(t,p(p({},this.options),{parent:this,id:n.id||t.id})),a=p(p({},fr),n);a.sync&&i.onTransition(function(c){r.send(mt,{state:c,id:i.id})});var o=i;return this.children.set(i.id,o),a.autoForward&&this.forwardTo.add(i.id),i.onDone(function(c){r.removeChild(i.id),r.send(K(c,{origin:i.id}))}).start(),o},e.prototype.spawnBehavior=function(t,n){var r=jn(t,{id:n,parent:this});return this.children.set(n,r),r},e.prototype.spawnPromise=function(t,n){var r,i=this,a=!1,o;t.then(function(s){a||(o=s,i.removeChild(n),i.send(K(lt(n,s),{origin:n})))},function(s){if(!a){i.removeChild(n);var u=ht(n,s);try{i.send(K(u,{origin:n}))}catch(d){ln(s,d,n),i.devTools&&i.devTools.send(u,i.state),i.machine.strict&&i.stop()}}});var c=(r={id:n,send:function(){},subscribe:function(s,u,d){var l=Dt(s,u,d),f=!1;return t.then(function(h){f||(l.next(h),!f&&l.complete())},function(h){f||l.error(h)}),{unsubscribe:function(){return f=!0}}},stop:function(){a=!0},toJSON:function(){return{id:n}},getSnapshot:function(){return o}},r[it]=function(){return this},r);return this.children.set(n,c),c},e.prototype.spawnCallback=function(t,n){var r,i=this,a=!1,o=new Set,c=new Set,s,u=function(f){s=f,c.forEach(function(h){return h(f)}),!a&&i.send(K(f,{origin:n}))},d;try{d=t(u,function(f){o.add(f)})}catch(f){this.send(ht(n,f))}if(Te(d))return this.spawnPromise(d,n);var l=(r={id:n,send:function(f){return o.forEach(function(h){return h(f)})},subscribe:function(f){var h=Dt(f);return c.add(h.next),{unsubscribe:function(){c.delete(h.next)}}},stop:function(){a=!0,C(d)&&d()},toJSON:function(){return{id:n}},getSnapshot:function(){return s}},r[it]=function(){return this},r);return this.children.set(n,l),l},e.prototype.spawnObservable=function(t,n){var r,i=this,a,o=t.subscribe(function(s){a=s,i.send(K(s,{origin:n}))},function(s){i.removeChild(n),i.send(K(ht(n,s),{origin:n}))},function(){i.removeChild(n),i.send(K(lt(n),{origin:n}))}),c=(r={id:n,send:function(){},subscribe:function(s,u,d){return t.subscribe(s,u,d)},stop:function(){return o.unsubscribe()},getSnapshot:function(){return a},toJSON:function(){return{id:n}}},r[it]=function(){return this},r);return this.children.set(n,c),c},e.prototype.spawnActor=function(t,n){return this.children.set(n,t),t},e.prototype.spawnActivity=function(t){var n=this.machine.options&&this.machine.options.activities?this.machine.options.activities[t.type]:void 0;if(!n){L||U(!1,"No implementation found for activity '".concat(t.type,"'"));return}var r=n(this.state.context,t);this.spawnEffect(t.id,r)},e.prototype.spawnEffect=function(t,n){var r;this.children.set(t,(r={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:n||void 0,getSnapshot:function(){},toJSON:function(){return{id:t}}},r[it]=function(){return this},r))},e.prototype.attachDev=function(){var t=ye();if(this.options.devTools&&t){if(t.__REDUX_DEVTOOLS_EXTENSION__){var n=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=t.__REDUX_DEVTOOLS_EXTENSION__.connect(p(p({name:this.id,autoPause:!0,stateSanitizer:function(r){return{value:r.value,context:r.context,actions:r.actions}}},n),{features:p({jump:!1,skip:!1},n?n.features:void 0)}),this.machine),this.devTools.init(this.state)}Mn(this)}},e.prototype.toJSON=function(){return{id:this.id}},e.prototype[it]=function(){return this},e.prototype.getSnapshot=function(){return this.status===J.NotStarted?this.initialState:this._state},e.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(t,n){return setTimeout(t,n)},clearTimeout:function(t){return clearTimeout(t)}},logger:console.log.bind(console),devTools:!1},e.interpret=ve,e}();function ve(e,t){var n=new Nn(e,t);return n}function lr(e){if(typeof e=="string"){var t={type:e};return t.toString=function(){return e},t}return e}function te(e){return p(p({type:Pt},e),{toJSON:function(){e.onDone,e.onError;var t=It(e,["onDone","onError"]);return p(p({},t),{type:Pt,src:lr(e.src)})}})}var $t="",$e="#",ee="*",jt={},Nt=function(e){return e[0]===$e},hr=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},pr=function(e,t,n){var r=n.slice(0,-1).some(function(a){return!("cond"in a)&&!("in"in a)&&(P(a.target)||at(a.target))}),i=t===$t?"the transient event":"event '".concat(t,"'");U(!r,"One or more transitions for ".concat(i," on state '").concat(e.id,"' are unreachable. ")+"Make sure that the default transition is the last one defined.")},$n=function(){function e(t,n,r,i){r===void 0&&(r="context"in t?t.context:void 0);var a=this,o;this.config=t,this._context=r,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(hr(),n),this.parent=i?.parent,this.key=this.config.key||i?.key||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:ie),this.id=this.config.id||_([this.machine.key],T(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(o=this.config.schema)!==null&&o!==void 0?o:{},this.description=this.config.description,L||U(!("parallel"in this.config),'The "parallel" property is deprecated and will be removed in version 4.1. '.concat(this.config.parallel?"Replace with `type: 'parallel'`":"Use `type: '".concat(this.type,"'`")," in the config for state node '").concat(this.id,"' instead.")),this.initial=this.config.initial,this.states=this.config.states?At(this.config.states,function(u,d){var l,f=new e(u,{},void 0,{parent:a,key:d});return Object.assign(a.idMap,p((l={},l[f.id]=f,l),f.idMap)),f}):jt;var c=0;function s(u){var d,l;u.order=c++;try{for(var f=I(Oe(u)),h=f.next();!h.done;h=f.next()){var y=h.value;s(y)}}catch(v){d={error:v}}finally{try{h&&!h.done&&(l=f.return)&&l.call(f)}finally{if(d)throw d.error}}}s(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(u){var d=u.event;return d===$t}):$t in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=Y(this.config.entry||this.config.onEntry).map(function(u){return St(u)}),this.onExit=Y(this.config.exit||this.config.onExit).map(function(u){return St(u)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=Y(this.config.invoke).map(function(u,d){var l,f;if(at(u)){var h=Vt(a.id,d);return a.machine.options.services=p((l={},l[h]=u,l),a.machine.options.services),te({src:h,id:h})}else if(P(u.src)){var h=u.id||Vt(a.id,d);return te(p(p({},u),{id:h,src:u.src}))}else if(at(u.src)||C(u.src)){var h=u.id||Vt(a.id,d);return a.machine.options.services=p((f={},f[h]=u.src,f),a.machine.options.services),te(p(p({id:h},u),{src:h}))}else{var y=u.src;return te(p(p({id:Vt(a.id,d)},u),{src:y}))}}),this.activities=Y(this.config.activities).concat(this.invoke).map(function(u){return Wt(u)}),this.transition=this.transition.bind(this),this.tags=Y(this.config.tags)}return e.prototype._init=function(){this.__cache.transitions||Le(this).forEach(function(t){return t.on})},e.prototype.withConfig=function(t,n){var r=this.options,i=r.actions,a=r.activities,o=r.guards,c=r.services,s=r.delays;return new e(this.config,{actions:p(p({},i),t.actions),activities:p(p({},a),t.activities),guards:p(p({},o),t.guards),services:p(p({},c),t.services),delays:p(p({},s),t.delays)},n??this.context)},e.prototype.withContext=function(t){return new e(this.config,this.options,t)},Object.defineProperty(e.prototype,"context",{get:function(){return C(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:At(this.states,function(t){return t.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return this.definition},Object.defineProperty(e.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var t=this.transitions;return this.__cache.on=t.reduce(function(n,r){return n[r.eventType]=n[r.eventType]||[],n[r.eventType].push(r),n},{})},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),e.prototype.getCandidates=function(t){if(this.__cache.candidates[t])return this.__cache.candidates[t];var n=t===$t,r=this.transitions.filter(function(i){var a=i.eventType===t;return n?a:a||i.eventType===ee});return this.__cache.candidates[t]=r,r},e.prototype.getDelayedTransitions=function(){var t=this,n=this.config.after;if(!n)return[];var r=function(a,o){var c=C(a)?"".concat(t.id,":delay[").concat(o,"]"):a,s=ke(c,t.id);return t.onEntry.push(ut(s,{delay:a})),t.onExit.push(Ce(s)),s},i=ct(n)?n.map(function(a,o){var c=r(a.delay,o);return p(p({},a),{event:c})}):j(Object.keys(n).map(function(a,o){var c=n[a],s=P(c)?{target:c}:c,u=isNaN(+a)?a:+a,d=r(u,o);return Y(s).map(function(l){return p(p({},l),{event:d,delay:u})})}));return i.map(function(a){var o=a.delay;return p(p({},t.formatTransition(a)),{delay:o})})},e.prototype.getStateNodes=function(t){var n,r=this;if(!t)return[];var i=t instanceof Q?t.value:Ct(t,this.delimiter);if(P(i)){var a=this.getStateNode(i).initial;return a!==void 0?this.getStateNodes((n={},n[i]=a,n)):[this,this.states[i]]}var o=Object.keys(i),c=[this];return c.push.apply(c,_([],T(j(o.map(function(s){return r.getStateNode(s).getStateNodes(i[s])}))),!1)),c},e.prototype.handles=function(t){var n=se(t);return this.events.includes(n)},e.prototype.resolveState=function(t){var n=t instanceof Q?t:Q.create(t),r=Array.from(Lt([],this.getStateNodes(n.value)));return new Q(p(p({},n),{value:this.resolve(n.value),configuration:r,done:Zt(r,this),tags:Fe(r),machine:this.machine}))},e.prototype.transitionLeafNode=function(t,n,r){var i=this.getStateNode(t),a=i.next(n,r);return!a||!a.transitions.length?this.next(n,r):a},e.prototype.transitionCompoundNode=function(t,n,r){var i=Object.keys(t),a=this.getStateNode(i[0]),o=a._transition(t[i[0]],n,r);return!o||!o.transitions.length?this.next(n,r):o},e.prototype.transitionParallelNode=function(t,n,r){var i,a,o={};try{for(var c=I(Object.keys(t)),s=c.next();!s.done;s=c.next()){var u=s.value,d=t[u];if(d){var l=this.getStateNode(u),f=l._transition(d,n,r);f&&(o[u]=f)}}}catch(g){i={error:g}}finally{try{s&&!s.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}var h=Object.keys(o).map(function(g){return o[g]}),y=j(h.map(function(g){return g.transitions})),v=h.some(function(g){return g.transitions.length>0});if(!v)return this.next(n,r);var b=j(Object.keys(o).map(function(g){return o[g].configuration}));return{transitions:y,exitSet:j(h.map(function(g){return g.exitSet})),configuration:b,source:n,actions:j(Object.keys(o).map(function(g){return o[g].actions}))}},e.prototype._transition=function(t,n,r){return P(t)?this.transitionLeafNode(t,n,r):Object.keys(t).length===1?this.transitionCompoundNode(t,n,r):this.transitionParallelNode(t,n,r)},e.prototype.getTransitionData=function(t,n){return this._transition(t.value,t,K(n))},e.prototype.next=function(t,n){var r,i,a=this,o=n.name,c=[],s=[],u;try{for(var d=I(this.getCandidates(o)),l=d.next();!l.done;l=d.next()){var f=l.value,h=f.cond,y=f.in,v=t.context,b=y?P(y)&&Nt(y)?t.matches(Ct(this.getStateNodeById(y).path,this.delimiter)):Jt(Ct(y,this.delimiter),tn(this.path.slice(0,-2))(t.value)):!0,g=!1;try{g=!h||de(this.machine,h,v,n,t)}catch(x){throw new Error("Unable to evaluate guard '".concat(h.name||h.type,"' in transition for event '").concat(o,"' in state node '").concat(this.id,`':
`).concat(x.message))}if(g&&b){f.target!==void 0&&(s=f.target),c.push.apply(c,_([],T(f.actions),!1)),u=f;break}}}catch(x){r={error:x}}finally{try{l&&!l.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}if(u){if(!s.length)return{transitions:[u],exitSet:[],configuration:t.value?[this]:[],source:t,actions:c};var m=j(s.map(function(x){return a.getRelativeStateNodes(x,t.historyValue)})),w=!!u.internal;return{transitions:[u],exitSet:w?[]:j(s.map(function(x){return a.getPotentiallyReenteringNodes(x)})),configuration:m,source:t,actions:c}}},e.prototype.getPotentiallyReenteringNodes=function(t){if(this.order<t.order)return[this];for(var n=[],r=this,i=t;r&&r!==i;)n.push(r),r=r.parent;return r!==i?[]:(n.push(i),n)},e.prototype.getActions=function(t,n,r,i,a,o,c){var s,u,d,l,f=this,h=o?Lt([],this.getStateNodes(o.value)):[],y=new Set;try{for(var v=I(Array.from(t).sort(function(E,$){return E.order-$.order})),b=v.next();!b.done;b=v.next()){var g=b.value;(!Ft(h,g)||Ft(r.exitSet,g)||g.parent&&y.has(g.parent))&&y.add(g)}}catch(E){s={error:E}}finally{try{b&&!b.done&&(u=v.return)&&u.call(v)}finally{if(s)throw s.error}}try{for(var m=I(h),w=m.next();!w.done;w=m.next()){var g=w.value;(!Ft(t,g)||Ft(r.exitSet,g.parent))&&r.exitSet.push(g)}}catch(E){d={error:E}}finally{try{w&&!w.done&&(l=m.return)&&l.call(m)}finally{if(d)throw d.error}}r.exitSet.sort(function(E,$){return $.order-E.order});var x=Array.from(y).sort(function(E,$){return E.order-$.order}),N=new Set(r.exitSet),O=j(x.map(function(E){var $=[];if(E.type!=="final")return $;var G=E.parent;if(!G.parent)return $;$.push(_t(E.id,E.doneData),_t(G.id,E.doneData?gt(E.doneData,i,a):void 0));var X=G.parent;return X.type==="parallel"&&Ot(X).every(function(Bt){return Zt(r.configuration,Bt)})&&$.push(_t(X.id)),$})),D=x.map(function(E){var $=E.onEntry,G=E.activities.map(function(X){return Ae(X)});return{type:"entry",actions:nt(c?_(_([],T($),!1),T(G),!1):_(_([],T(G),!1),T($),!1),f.machine.options.actions)}}).concat({type:"state_done",actions:O.map(function(E){return le(E)})}),M=Array.from(N).map(function(E){return{type:"exit",actions:nt(_(_([],T(E.onExit),!1),T(E.activities.map(function($){return he($)})),!1),f.machine.options.actions)}}),A=M.concat({type:"transition",actions:nt(r.actions,this.machine.options.actions)}).concat(D);if(n){var z=nt(j(_([],T(t),!1).sort(function(E,$){return $.order-E.order}).map(function(E){return E.onExit})),this.machine.options.actions).filter(function(E){return!Xt(E)});return A.concat({type:"stop",actions:z})}return A},e.prototype.transition=function(t,n,r,i){t===void 0&&(t=this.initialState);var a=K(n),o;if(t instanceof Q)o=r===void 0?t:this.resolveState(Q.from(t,r));else{var c=P(t)?this.resolve(Kt(this.getResolvedPath(t))):this.resolve(t),s=r??this.machine.context;o=this.resolveState(Q.from(c,s))}if(!L&&a.name===ee)throw new Error("An event cannot have the wildcard type ('".concat(ee,"')"));if(this.strict&&!this.events.includes(a.name)&&!rn(a.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(a.name,"'"));var u=this._transition(o.value,o,a)||{transitions:[],configuration:[],exitSet:[],source:o,actions:[]},d=Lt([],this.getStateNodes(o.value)),l=u.configuration.length?Lt(d,u.configuration):d;return u.configuration=_([],T(l),!1),this.resolveTransition(u,o,o.context,i,a)},e.prototype.resolveRaisedTransition=function(t,n,r,i){var a,o=t.actions;return t=this.transition(t,n,void 0,i),t._event=r,t.event=r.data,(a=t.actions).unshift.apply(a,_([],T(o),!1)),t},e.prototype.resolveTransition=function(t,n,r,i,a){var o,c,s,u,d=this;a===void 0&&(a=ot);var l=t.configuration,f=!n||t.transitions.length>0,h=f?t.configuration:n?n.configuration:[],y=Zt(h,this),v=f?Dn(this.machine,l):void 0,b=n?n.historyValue?n.historyValue:t.source?this.machine.historyValue(n.value):void 0:void 0,g=this.getActions(new Set(h),y,t,r,a,n,i),m=n?p({},n.activities):{};try{for(var w=I(g),x=w.next();!x.done;x=w.next()){var N=x.value;try{for(var O=(s=void 0,I(N.actions)),D=O.next();!D.done;D=O.next()){var M=D.value;M.type===Et?m[M.activity.id||M.activity.type]=M:M.type===vt&&(m[M.activity.id||M.activity.type]=!1)}}catch(tt){s={error:tt}}finally{try{D&&!D.done&&(u=O.return)&&u.call(O)}finally{if(s)throw s.error}}}}catch(tt){o={error:tt}}finally{try{x&&!x.done&&(c=w.return)&&c.call(w)}finally{if(o)throw o.error}}var A=T(bt(this,n,r,a,g,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),z=A[0],E=A[1],$=T(on(z,Xt),2),G=$[0],X=$[1],Bt=z.filter(function(tt){var xt;return tt.type===Et&&((xt=tt.activity)===null||xt===void 0?void 0:xt.type)===Pt}),me=Bt.reduce(function(tt,xt){return tt[xt.activity.id]=Pn(xt.activity,d.machine,E,a),tt},n?p({},n.children):{}),yt=new Q({value:v||n.value,context:E,_event:a,_sessionid:n?n._sessionid:null,historyValue:v?b?cn(b,v):void 0:n?n.historyValue:void 0,history:!v||t.source?n:void 0,actions:v?X:[],activities:v?m:n?n.activities:{},events:[],configuration:h,transitions:t.transitions,children:me,done:y,tags:Fe(h),machine:this}),dt=r!==E;yt.changed=a.name===mt||dt;var H=yt.history;H&&delete H.history;var We=!y&&(this._transient||l.some(function(tt){return tt._transient}));if(!f&&(!We||a.name===$t))return yt;var Z=yt;if(!y)for(We&&(Z=this.resolveRaisedTransition(Z,{type:ge},a,i));G.length;){var Vn=G.shift();Z=this.resolveRaisedTransition(Z,Vn._event,a,i)}var Xn=Z.changed||(H?!!Z.actions.length||dt||typeof H.value!=typeof Z.value||!Me(Z.value,H.value):void 0);return Z.changed=Xn,Z.history=H,Z},e.prototype.getStateNode=function(t){if(Nt(t))return this.machine.getStateNodeById(t);if(!this.states)throw new Error("Unable to retrieve child state '".concat(t,"' from '").concat(this.id,"'; no child states exist."));var n=this.states[t];if(!n)throw new Error("Child state '".concat(t,"' does not exist on '").concat(this.id,"'"));return n},e.prototype.getStateNodeById=function(t){var n=Nt(t)?t.slice($e.length):t;if(n===this.id)return this;var r=this.machine.idMap[n];if(!r)throw new Error("Child state node '#".concat(n,"' does not exist on machine '").concat(this.id,"'"));return r},e.prototype.getStateNodeByPath=function(t){if(typeof t=="string"&&Nt(t))try{return this.getStateNodeById(t.slice(1))}catch{}for(var n=ce(t,this.delimiter).slice(),r=this;n.length;){var i=n.shift();if(!i.length)break;r=r.getStateNode(i)}return r},e.prototype.resolve=function(t){var n,r=this;if(!t)return this.initialStateValue||jt;switch(this.type){case"parallel":return At(this.initialStateValue,function(a,o){return a?r.getStateNode(o).resolve(t[o]||a):jt});case"compound":if(P(t)){var i=this.getStateNode(t);return i.type==="parallel"||i.type==="compound"?(n={},n[t]=i.initialStateValue,n):t}return Object.keys(t).length?At(t,function(a,o){return a?r.getStateNode(o).resolve(a):jt}):this.initialStateValue||{};default:return t||jt}},e.prototype.getResolvedPath=function(t){if(Nt(t)){var n=this.machine.idMap[t.slice($e.length)];if(!n)throw new Error("Unable to find state node '".concat(t,"'"));return n.path}return ce(t,this.delimiter)},Object.defineProperty(e.prototype,"initialStateValue",{get:function(){var t;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var n;if(this.type==="parallel")n=Ee(this.states,function(r){return r.initialStateValue||jt},function(r){return r.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));n=Ht(this.states[this.initial])?this.initial:(t={},t[this.initial]=this.states[this.initial].initialStateValue,t)}else n={};return this.__cache.initialStateValue=n,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),e.prototype.getInitialState=function(t,n){this._init();var r=this.getStateNodes(t);return this.resolveTransition({configuration:r,exitSet:[],transitions:[],source:void 0,actions:[]},void 0,n??this.machine.context,void 0)},Object.defineProperty(e.prototype,"initialState",{get:function(){var t=this.initialStateValue;if(!t)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"target",{get:function(){var t;if(this.type==="history"){var n=this.config;P(n.target)?t=Nt(n.target)?Kt(this.machine.getStateNodeById(n.target).path.slice(this.path.length-1)):n.target:t=n.target}return t},enumerable:!1,configurable:!0}),e.prototype.getRelativeStateNodes=function(t,n,r){return r===void 0&&(r=!0),r?t.type==="history"?t.resolveHistory(n):t.initialStateNodes:[t]},Object.defineProperty(e.prototype,"initialStateNodes",{get:function(){var t=this;if(Ht(this))return[this];if(this.type==="compound"&&!this.initial)return L||U(!1,"Compound state node '".concat(this.id,"' has no initial state.")),[this];var n=Gt(this.initialStateValue);return j(n.map(function(r){return t.getFromRelativePath(r)}))},enumerable:!1,configurable:!0}),e.prototype.getFromRelativePath=function(t){if(!t.length)return[this];var n=T(t),r=n[0],i=n.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(r,"' from node with no states"));var a=this.getStateNode(r);if(a.type==="history")return a.resolveHistory();if(!this.states[r])throw new Error("Child state '".concat(r,"' does not exist on '").concat(this.id,"'"));return this.states[r].getFromRelativePath(i)},e.prototype.historyValue=function(t){if(Object.keys(this.states).length)return{current:t||this.initialStateValue,states:Ee(this.states,function(n,r){if(!t)return n.historyValue();var i=P(t)?void 0:t[r];return n.historyValue(i||n.initialStateValue)},function(n){return!n.history})}},e.prototype.resolveHistory=function(t){var n=this;if(this.type!=="history")return[this];var r=this.parent;if(!t){var i=this.target;return i?j(Gt(i).map(function(o){return r.getFromRelativePath(o)})):r.initialStateNodes}var a=en(r.path,"states")(t).current;return P(a)?[r.getStateNode(a)]:j(Gt(a).map(function(o){return n.history==="deep"?r.getFromRelativePath(o):[r.states[o[0]]]}))},Object.defineProperty(e.prototype,"stateIds",{get:function(){var t=this,n=j(Object.keys(this.states).map(function(r){return t.states[r].stateIds}));return[this.id].concat(n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"events",{get:function(){var t,n,r,i;if(this.__cache.events)return this.__cache.events;var a=this.states,o=new Set(this.ownEvents);if(a)try{for(var c=I(Object.keys(a)),s=c.next();!s.done;s=c.next()){var u=s.value,d=a[u];if(d.states)try{for(var l=(r=void 0,I(d.events)),f=l.next();!f.done;f=l.next()){var h=f.value;o.add("".concat(h))}}catch(y){r={error:y}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(r)throw r.error}}}}catch(y){t={error:y}}finally{try{s&&!s.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return this.__cache.events=Array.from(o)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ownEvents",{get:function(){var t=new Set(this.transitions.filter(function(n){return!(!n.target&&!n.actions.length&&n.internal)}).map(function(n){return n.eventType}));return Array.from(t)},enumerable:!1,configurable:!0}),e.prototype.resolveTarget=function(t){var n=this;if(t!==void 0)return t.map(function(r){if(!P(r))return r;var i=r[0]===n.delimiter;if(i&&!n.parent)return n.getStateNodeByPath(r.slice(1));var a=i?n.key+r:r;if(n.parent)try{var o=n.parent.getStateNodeByPath(a);return o}catch(c){throw new Error("Invalid transition definition for state node '".concat(n.id,`':
`).concat(c.message))}else return n.getStateNodeByPath(a)})},e.prototype.formatTransition=function(t){var n=this,r=fn(t.target),i="internal"in t?t.internal:r?r.some(function(s){return P(s)&&s[0]===n.delimiter}):!0,a=this.machine.options.guards,o=this.resolveTarget(r),c=p(p({},t),{actions:nt(Y(t.actions)),cond:ue(t.cond,a),target:o,source:this,internal:i,eventType:t.event,toJSON:function(){return p(p({},c),{target:c.target?c.target.map(function(s){return"#".concat(s.id)}):void 0,source:"#".concat(n.id)})}});return c},e.prototype.formatTransitions=function(){var t,n,r=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var a=this.config.on,o=ee,c=a[o],s=c===void 0?[]:c,u=It(a,[typeof o=="symbol"?o:o+""]);i=j(Object.keys(u).map(function(m){!L&&m===$t&&U(!1,"Empty string transition configs (e.g., `{ on: { '': ... }}`) for transient transitions are deprecated. Specify the transition in the `{ always: ... }` property instead. "+'Please check the `on` configuration for "#'.concat(r.id,'".'));var w=wt(m,u[m]);return L||pr(r,m,w),w}).concat(wt(ee,s)))}var d=this.config.always?wt("",this.config.always):[],l=this.config.onDone?wt(String(_t(this.id)),this.config.onDone):[];L||U(!(this.config.onDone&&!this.parent),'Root nodes cannot have an ".onDone" transition. Please check the config of "'.concat(this.id,'".'));var f=j(this.invoke.map(function(m){var w=[];return m.onDone&&w.push.apply(w,_([],T(wt(String(lt(m.id)),m.onDone)),!1)),m.onError&&w.push.apply(w,_([],T(wt(String(ht(m.id)),m.onError)),!1)),w})),h=this.after,y=j(_(_(_(_([],T(l),!1),T(f),!1),T(i),!1),T(d),!1).map(function(m){return Y(m).map(function(w){return r.formatTransition(w)})}));try{for(var v=I(h),b=v.next();!b.done;b=v.next()){var g=b.value;y.push(g)}}catch(m){t={error:m}}finally{try{b&&!b.done&&(n=v.return)&&n.call(v)}finally{if(t)throw t.error}}return y},e}();var Rn=!1;function Re(e,t){return!L&&!("predictableActionArguments"in e)&&!Rn&&(Rn=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new $n(e,t)}var Bn=ut;var S=Qt;function R(e,t,n,r){let i=W(n,rt(t));return new Promise((a,o)=>{let c=e.transaction("lock","readwrite").objectStore("lock"),s=Date.now(),u=c.add({pathPrefix:i,expiry:s+r,createdAt:s});u.onsuccess=d=>{a(d.target.result)},u.onerror=()=>{o(`Could not acquire lock for path prefix ${i}`)}})}function B(e,t){return new Promise(n=>{let i=e.transaction("lock","readwrite").objectStore("lock").delete(t);i.onsuccess=()=>{n(1)},i.onerror=()=>{n(0)}})}function yr(e,t){return new Promise((n,r)=>{let a=e.transaction("lock","readonly").objectStore("lock").get(t);a.onsuccess=o=>{o.target.result?n(o.target.result):r(`Could not find lock with id ${t}`)},a.onerror=()=>{r(`Could not get lock with id ${t}.`)}})}function Be(e,t){return new Promise((n,r)=>{let o=e.transaction("content","readonly").objectStore("content").index("leafId").get(IDBKKeyRange.only(t.id));o.onsuccess=c=>{n({...t,content:c.target.result.body||null})},o.onerror=()=>{n({...t,content:null})}})}function F(e,t){return new Promise((n,r)=>{let a=e.transaction("entity","readonly").objectStore("entity").get(t);a.onsuccess=o=>{o.target.result?n(o.target.result):r(`Could not find entity with id ${t}`)},a.onerror=()=>{r(`Could not get entity with id ${t}.`)}})}function V(e,t,n){let r=W(n,rt(t));return new Promise((i,a)=>{let s=e.transaction("entity","readonly").objectStore("entity").index("path").get(r);s.onsuccess=u=>{u.target.result?i(u.target.result):a(`Could not find entity with path ${r}`)},s.onerror=()=>{a(`Could not get entity with path ${r}.`)}})}function qe(e,t,n){return F(e,n).then(r=>{if(r.isLeaf)throw"Not a directory";return new Promise((i,a)=>{let s=e.transaction("entity","readonly").objectStore("entity").index("parentId").getAllKeys(IDBKeyRange.only(r.id));s.onsuccess=u=>{i(u.target.result)},s.onerror=()=>{a(`Could not get child keys of directory with id ${n}.`)}})})}function vr(e,t,n){return new Promise((r,i)=>{let o=e.transaction("content","readwrite").objectStore("content").put(n,t);o.onsuccess=c=>{r({contentId:c.target.result})},o.onerror=()=>{i(`Could not insert content record for leaf with id ${t}.`)}})}function mr(e,t,n){return new Promise((r,i)=>{let c=e.transaction("content","readwrite").objectStore("content").index("leafId").openCursor(IDBKeyRange.only(t)),s=0;c.onsuccess=u=>{let d=u.target.result;d?(s+=1,d.update(n),d.continue()):r({contentUpdates:s})},c.onerror=()=>{i(`Could not update content record for leaf with id ${t}.`)}})}function qn(e,t){return new Promise((n,r)=>{let o=e.transaction("content","readwrite").objectStore("content").index("leafId").openCursor(IDBKeyRange.only(t)),c=0;o.onsuccess=s=>{let u=s.target.result;u?(c+=1,u.delete(),u.continue()):n({contentDeletes:c})},o.onerror=()=>{r(`Could not delete content record for leaf with id ${t}.`)}})}function q(e,t,n=!0){return Promise.all(t.map(r=>yr(e,r))).then(r=>new Promise((i,a)=>{let o=new Set(r.map(l=>l.id)),c=r.map(l=>l.pathPrefix),u=e.transaction("lock","readonly").objectStore("lock").index("expiry"),d=n?u.getAll(IDBKeyRange.lowerBound(Date.now())):u.getAll();d.onsuccess=l=>{let h=l.target.result.filter(y=>!o.has(y.id)).reduce((y,v)=>c.reduce((b,g)=>g.startsWith(curr.pathPrefix)?y+1:y,0)?y+1:y,0);h?a(`Just acquired locks conflict with prefixes of ${h} other locks. Considering only unexpired locks: ${n+""}.`):i(`No conflicting locks found. Considering only unexpired locks: ${n+""}.`)},d.onerror=()=>{a("Could not get comparison locks for conflict detection.")}}))}function Un(e,t,n,r,i){return F(e,r).then(a=>new Promise((o,c)=>{a.isLeaf&&c("Cannot designate leaf entity as parent of another leaf entity."),/^[a-zA-Z0-9_.-]+$/.test(n)||c(`Invalid file name: ${n}. File names must be alphanumeric, dashes, dots, and underscores.`);let s=W(a.path+n,rt(t)),u=Date.now(),l=e.transaction("entity","readwrite").objectStore("entity").add({path:s,isLeaf:!0,parentId:a.id,createdAt:u,updatedAt:u,name:n});l.onsuccess=f=>{o(f.target.result)},l.onerror=()=>{c(`Could not add file entity with name ${n} to parent ${a.path}.`)}})).then(a=>vr(e,a,i))}function Ue(e,t,n,r){return F(e,r).then(i=>new Promise((a,o)=>{let c=W(i.path+n,rt(t)),s=Date.now(),d=e.transaction("entity","readwrite").objectStore("entity").add({path:c,isLeaf:!1,parentId:i.id,createdAt:s,updatedAt:s,name:n});d.onsuccess=l=>{a(l.target.result)},d.onerror=()=>{o(`Could not add directory entity with name ${n} to parent ${i.path}.`)}}))}function zn(e,t){return new Promise((n,r)=>{let a=e.transaction("entity","readonly").objectStore("entity").delete(t);a.onsuccess=()=>{n(t)},a.onerror=()=>{r(`Could not delete entity with id ${t}; it may have already been deleted.`)}})}function ze(e,t){return F(e,t).then(n=>{if(!n.isLeaf)throw`Cannot delete non-leaf entity with id ${t}.`;return zn(e,t)}).then(n=>qn(e,n))}function Ke(e,t){return F(e,t).then(n=>new Promise((r,i)=>{n.isLeaf&&i(`Cannot delete directory with id ${t} because it is a leaf.`);let c=e.transaction("entity","readwrite").objectStore("entity").index("parentId").count(IDBKeyRange.only(t));c.onsuccess=()=>{c.result!==0&&i(`Cannot delete directory with id ${t} because it is not empty.`),r(t)},c.onerror=()=>{i(`Could not count number of children for directory with id ${t}.`)}})).then(n=>zn(e,n))}function Je(e,t){return F(e,t).then(n=>new Promise((r,i)=>{n.isLeaf&&i(`Cannot empty directory with id ${t} because it is a leaf.`);let c=e.transaction("entity","readwrite").objectStore("entity").index("parentId").count(IDBKeyRange.only(t));c.onsuccess=()=>{c.result===0&&i(`Cannot empty directory with id ${t} because it is already empty.`),r(n.path)},c.onerror=()=>{i(`Could not count number of children for directory with id ${t}.`)}})).then(n=>new Promise((r,i)=>{let c=e.transaction("entity","readwrite").objectStore("entity").index("path").openCursor(IDBKKeyRange.bound(n,n+"\uFFFF",!0,!1)),s=[];var u=0;c.onsuccess=d=>{let l=d.target.result;l?(l.value.isLeaf&&s.push(l.value.id),l.delete(),u++,l.continue()):r(s)},c.onerror=()=>{i(`Could not empty directory with id ${t} and path ${n}.`)}})).then(n=>Promise.allSettled(n.map(r=>qn(e,r))))}function ne(e,t,n){return F(e,t).then(r=>new Promise((i,a)=>{r.isLeaf||a(`Entity with id ${t} is not a leaf entity.`);let o=Date.now(),s=e.transaction("entity","readwrite").objectStore("entity").openCursor(IDBKeyRange.only(t)),u={};var d=0;s.onsuccess=l=>{let f=l.target.result;if(f){let h=f.value;h.updatedAt=o,u[h.id]=n,f.update(h),++d,f.continue()}else i(u)},s.onerror=()=>{a(`Could not update file entity with id ${t}.`)}})).then(r=>Promise.allSettled(Object.entries(r).map(i=>mr(e,i[0],i[1]))))}function Ge(e,t){return F(e,t).then(n=>new Promise((r,i)=>{n.isLeaf||i(`Entity with id ${t} is not a leaf entity.`);let a=Date.now(),c=e.transaction("entity","readwrite").objectStore("entity").openCursor(IDBKeyRange.only(t));var s=0;c.onsuccess=u=>{let d=u.target.result;if(d){let l=d.value;l.updatedAt=a,d.update(l),++s,d.continue()}else r(s)},c.onerror=()=>{i(`Could not update file entity with id ${t}.`)}}))}function Ve(e,t,n,r){let i,a;return F(e,n).then(o=>(i=o,F(e,i.parentId))).then(o=>{a=o,new Promise((c,s)=>{i.isLeaf||s(`Entity with id ${n} is not a leaf entity.`),/^[a-zA-Z0-9_.-]+$/.test(r)||s(`Invalid file name: ${r}. File names must be alphanumeric, dashes, dots, and underscores.`);let u=W(a.path+r,rt(t)),l=e.transaction("entity","readwrite").objectStore("entity").openCursor(IDBKeyRange.only(n)),f=0;l.onsuccess=h=>{let y=h.target.result;if(y){let v=y.value;v.name=r,v.path=u,y.update(v),f++,y.continue()}else c(f)},l.onerror=()=>{s(`Could not rename file entity with id ${n} to ${r}.`)}})})}function Xe(e,t,n){return Promise.all([F(e,t),F(e,n)]).then(([r,i])=>new Promise((a,o)=>{i.isLeaf&&o("New parent cannot be a leaf entity.");let u=e.transaction("entity","readwrite").objectStore("entity").index("path").openCursor(IDBKeyRange.bound(r.path,r.path+"\uFFFF",!0,!1));var d=0;u.onsuccess=l=>{let f=l.target.result;if(f){let h=f.value;h.id===i.id&&f.continue(),h.parentId===r.id&&(h.parentId=i.id),h.path=W(h.path.replace(new RegExp(`^${r.path}`),i.path),rt(cwd)),h.updatedAt=Date.now(),f.update(h),d++,f.continue()}else a(`Ancestors transplanted: ${d}.`)},u.onerror=()=>{o(`Error reading entities where prefix is ${r.path} and suffix is non-empty.`)}}))}function Kn(e){return new Promise((t,n)=>{let i=e.transaction("lock","readonly").objectStore("lock").index("expiry").getAllKeys(IDBKeyRange.upperBound(Date.now()));i.onsuccess=a=>{t(a.target.result)},i.onerror=()=>{n("Error reading expired locks.")}}).then(t=>Promise.allSettled(t.map(n=>new Promise((r,i)=>{let o=e.transaction("lock","readwrite").objectStore("lock").delete(n);o.onsuccess=()=>{r("Expired lock pruned succesfully.")},o.onerror=()=>{i("Error deleting expired lock by id; it may have already been deleted.")}}))))}var{assign:Rt,log:Ye}=pe,gr=Re({initial:"uninitialized",context:{cwd:"/",fsName:null},states:{uninitialized:{initial:"idle",states:{idle:{entry:Ye(),on:{init:{target:"initializing",cond:(e,t)=>typeof t.filesystemName=="string",actions:Rt((e,t)=>({...e,fsName:t.filesystemName}))}}},initializing:{invoke:{src:e=>new Promise((t,n)=>{let r=indexedDB.open(e.fsName,version);r.onsuccess=i=>{db=i.target.result,t(db)},r.onerror=()=>{n()},r.onupgradeneeded=i=>{let a=i.target.result,o=a.createObjectStore("entity",{autoIncrement:!0});o.createIndex("name","name"),o.createIndex("parentId","parentId"),o.createIndex("createdAt","createdAt"),o.createIndex("updatedAt","updatedAt"),o.createIndex("path","path",{unique:!0}),o.createIndex("uniqueParentChild",["parentId","name"],{unique:!0});let c=a.createObjectStore("lock",{autoIncrement:!0});c.createIndex("pathPrefix","pathPrefix",{unique:!0}),c.createIndex("expiry","expiry"),c.createIndex("createdAt","createdAt"),a.createObjectStore("content",{autoIncrement:!0}).createIndex("leafId","leafId",{unique:!0})}}),onDone:{target:"seeding",actions:Rt((e,t)=>({...e,db:t.data}))},onError:{target:"idle",actions:Ye("Failed to initialize filesystem.")}}},seeding:{invoke:{src:e=>new Promise((t,n)=>{let{db:r}=e,i=r.transaction("entity","readwrite").objectStore("entity"),a=Date.now(),o=i.add({name:"",path:"/",isLeaf:!1,parentId:null,createdAt:a,updatedAt:a});o.onsuccess=()=>{t()},o.onerror=({name:c})=>{c==="ConstraintError"?t():n()}}),onDone:{target:"done"},onError:{target:"idle",actions:Ye("Attempt to conditionally seed root directory / failed and it was not a unique constraint violation.")}}},done:{type:"final"}},onDone:"initialized"},initialized:{type:"parallel",states:{lockTablePruner:{initial:"idle",states:{idle:{on:{pruneExpiredLocks:"pruning"}},pruning:{invoke:{src:({db:e})=>Kn(e),onDone:"idle",onError:"idle"}},done:{type:"final"}},on:{stopLockPruningService:".done"}},operator:{initial:"awaitingCommand",states:{awaitingCommand:{on:{close:"close",createFile:"createFile",readFileById:"readFileById",readFileByPath:"readFileByPath",renameFileById:"renameFileById",renameFileByPath:"renameFileByPath"}},changeDirectoryById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{newDirectoryId:i}=t.data;return new Promise((a,o)=>{(async()=>{try{let c=await F(n,i);c.isLeaf&&o("Cannot change directory to a leaf."),a(c.path)}catch(c){o(c)}})()})},onDone:{target:"awaitingCommand",actions:[Rt((e,t)=>({...e,cwd:t.data})),S("changeDirectorySuccess")]},onError:{target:"awaitingCommand",actions:[S("changeDirectoryFailure")]}}},changeDirectoryByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{newDirectoryPath:i}=t.data;return new Promise((a,o)=>{(async()=>{try{let c=await V(n,i);c.isLeaf&&o("Cannot change directory to a leaf."),a(c.path)}catch(c){o(c)}})()})},onDone:{target:"awaitingCommand",actions:[Rt((e,t)=>({...e,cwd:t.data})),S("changeDirectorySuccess")]},onError:{target:"awaitingCommand",actions:[S("changeDirectoryFailure")]}}},createFile:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{name:i,parentId:a,content:o}=t.data;return new Promise((c,s)=>{(async()=>{let u;try{let d=await F(n,a);u=await R(n,r,d.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[u])}catch(d){s(d)}try{let d=await Un(n,r,i,parent.id,o);c(d)}catch(d){s(d)}finally{try{await B(n,u)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"createFileSuccess",newFileId:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"createFileFailure",msg:t.data}))}}},readFileById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);if(c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf){let u=await Be(n,s);a(u)}else o(`Cannot read a directory. Path: ${s.path}`)}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"readFileSuccess",file:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"readFileFailure",msg:t.data}))}}},readFileByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);if(c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf){let u=await Be(n,s);a(u)}else o(`Cannot read a directory. Path: ${s.path}`)}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"readFileSuccess",file:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"readFileFailure",msg:t.data}))}}},renameFileById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i,newName:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let u=await F(n,i);s=await R(n,r,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Ve(n,r,u.id,a))}catch(u){c(u)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[S((e,t)=>({type:"renameFileSuccess",filesRenamed:t.data}))]},onError:{target:"awaitingCommand",actions:[S((e,t)=>({type:"renameFileFailure",msg:t.data}))]}}},renameFileByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i,newName:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let u=await V(n,r,i);s=await R(n,r,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Ve(n,r,u.id,a))}catch(u){c(u)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[S((e,t)=>({type:"renameFileSuccess",filesRenamed:t.data}))]},onError:{target:"awaitingCommand",actions:[S((e,t)=>({type:"renameFileFailure",msg:t.data}))]}}},updateFileTimestampById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await Ge(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[S((e,t)=>({type:"updateFileTimestampSuccess",filesTouched:t.data}))]},onError:{target:"awaitingCommand",actions:[S((e,t)=>({type:"updateFileTimestampFailure",msg:t.data}))]}}},updateFileTimestampByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await Ge(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:[S((e,t)=>({type:"updateFileTimestampSuccess",filesTouched:t.data}))]},onError:{target:"awaitingCommand",actions:[S((e,t)=>({type:"updateFileTimestampFailure",msg:t.data}))]}}},updateFileContentById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i,content:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let u=await F(n,i);s=await R(n,r,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await ne(n,u.id,a))}catch(u){c(u)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileSuccess",filesTouched:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileFailure",msg:t.data}))}}},updateFileContentByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i,path:a,content:o}=t.data;return new Promise((c,s)=>{(async()=>{let u;try{let d=await V(n,r,a);u=await R(n,r,d.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[u]),c(await ne(n,d.id,o))}catch(d){s(d)}finally{try{await B(n,u)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileSuccess",filesTouched:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileFailure",msg:t.data}))}}},reparentFileById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i,newParentId:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let d=await F(n,i),l=await F(n,a),f=[];for(var u=0;u<Math.min(d.path.length,l.path.length)&&d.path[u]===l.path[u];u++)f.push(d.path[u]);let h=f.join("");s=await R(n,r,h,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await ne(n,d.id,content))}catch(d){c(d)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileSuccess",filesTouched:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileFailure",msg:t.data}))}}},reparentFileByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i,newParentPath:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let d=await V(n,r,i),l=await V(n,a),f=[];for(var u=0;u<Math.min(d.path.length,l.path.length)&&d.path[u]===l.path[u];u++)f.push(d.path[u]);let h=f.join("");s=await R(n,r,h,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await ne(n,d.id,content))}catch(d){c(d)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileSuccess",filesTouched:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"updateFileFailure",msg:t.data}))}}},deleteFileById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await ze(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileSuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileFailure",msg:t.data}))}}},deleteFileByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await ze(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileSuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileFailure",msg:t.data}))}}},createDirectoryUnderId:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{name:i,parentId:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let u=await F(n,a);s=await R(n,r,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Ue(n,r,i,u.id))}catch(u){c(u)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"createDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"createDirectoryFailure",msg:t.data}))}}},createDirectoryUnderPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{name:i,parentPath:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let u=await V(n,r,a);s=await R(n,r,u.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Ue(n,r,i,u.id))}catch(u){c(u)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"createDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"createDirectoryFailure",msg:t.data}))}}},getDirectoryRecordById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);if(c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf)o(`Cannot get directory record for leaf entity: ${s.path}`);else{let u=await qe(n,r,i);a({entity:s,childKeys:u})}}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"readDirectoryRecordSuccess",data:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"readDirectoryRecordFailure",msg:t.data}))}}},getDirectoryRecordByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);if(c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf)o(`Cannot get directory record for leaf entity: ${s.path}`);else{let u=await qe(n,r,id);a({entity:s,childKeys:u})}}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"readDirectoryRecordSuccess",data:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"readDirectoryRecordFailure",msg:t.data}))}}},emptyDirectoryById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf?o(`Cannot call empty directory for leaf entity: ${s.path}`):(await Je(n,i),a())}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"emptyDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"emptyDirectoryFailure",msg:t.data}))}}},emptyDirectoryByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),s.isLeaf?o(`Cannot call empty directory for leaf entity: ${s.path}`):(await Je(n,id),a())}catch(s){o(s)}finally{try{c&&await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"emptyDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"emptyDirectoryFailure",msg:t.data}))}}},deleteDirectoryIfEmptyById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{id:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await F(n,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await Ke(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteDirectorySuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteDirectoryFailure",msg:t.data}))}}},deleteDirectoryIfEmptyByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{path:i}=t.data;return new Promise((a,o)=>{(async()=>{let c;try{let s=await V(n,r,i);c=await R(n,r,s.path,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[c]),a(await Ke(n,s.id))}catch(s){o(s)}finally{try{await B(n,c)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileSuccess"}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"deleteFileFailure",msg:t.data}))}}},transplantAncestorsById:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{oldParentId:i,newParentId:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let d=await F(n,i),l=await F(n,a),f=[];for(var u=0;u<Math.min(d.path.length,l.path.length)&&d.path[u]===l.path[u];u++)f.push(d.path[u]);let h=f.join("");s=await R(n,r,h,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Xe(n,d.id,l.id))}catch(d){c(d)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"transplantAncestorsSuccess",msg:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"transplantAncestorsFailure",msg:t.data}))}}},transplantAncestorsByPath:{invoke:{src:(e,t)=>{let{db:n,cwd:r}=e,{oldParentPath:i,newParentPath:a}=t.data;return new Promise((o,c)=>{(async()=>{let s;try{let d=await V(n,r,i),l=await V(n,r,a),f=[];for(var u=0;u<Math.min(d.path.length,l.path.length)&&d.path[u]===l.path[u];u++)f.push(d.path[u]);let h=f.join("");s=await R(n,r,h,typeof t.durationMs=="number"&&t.durationMs>0?t.durationMs:5e3),await q(n,[s]),o(await Xe(n,d.id,l.id))}catch(d){c(d)}finally{try{await B(n,s)}catch{}}})()})},onDone:{target:"awaitingCommand",actions:S((e,t)=>({type:"transplantAncestorsSuccess",msg:t.data}))},onError:{target:"awaitingCommand",actions:S((e,t)=>({type:"transplantAncestorsFailure",msg:t.data}))}}},close:{type:"final",entry:[Bn("stopLockPruningService"),Rt(e=>(e.db.close(),{...e,db:null}))]}}}},onDone:{target:"uninitialized",actions:Rt(e=>({...e,fsName:null}))}}}}),Jn=gr;function wr(){let e=ve(Jn);e.start(),e.onTransition(t=>{console.log(t.event)}),e.send({type:"init",filesystemName:"test"})}var Gn=wr;He();Gn();})();
/*! Bundled license information:

xstate/es/_virtual/_tslib.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
